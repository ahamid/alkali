!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.alkali=t():e.alkali=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var r,i;r=[n(1),n(2),n(5),n(4),n(6),n(7)],i=function(e,t,n,r,i,o){var a=Object.create(e);return a.Copy=o,a.Element=e,a.Variable=t,a.all=t.all,a.react=n,a.spawn=function(e){return n(e).valueOf()},a.Renderer=r,Object.assign(a,r),Object.assign(a,i),a}.apply(t,r),!(void 0!==i&&(e.exports=i))},function(e,t,n){var r,i;r=[n(2),n(4),n(3)],i=function(e,t,n){function r(e){if("function"==typeof e){var t=e.constructor;return"GeneratorFunction"===(t.displayName||t.name)}}function i(e){this.subject=e}function o(e){return function(t,n,r){"boolean"==typeof n&&(n=e[n?0:1]),t.style[r]=n}}function a(e,t,n){"number"==typeof t&&(t+="px"),e.style[n]=t}function s(e,t,n){e.style[n]=t}function u(e,t,n,r){for(var i=t.length>3||r?Q.createDocumentFragment():e,o=0,a=t.length;o<a;o++){var s,l=t[o];if(l&&l.create)oe=e,s=l.create(),i.appendChild(s),l.isContentNode&&(n.contentNode=s);else if("function"==typeof l)s=new l,i.appendChild(s);else if("object"==typeof l)if(l instanceof Array)n=n||e,s=s||e,u(s.contentNode||s,l,n);else if(l.notifies)i.appendChild(s=c(e,l));else{if(!l.nodeType)throw new Error("Unknown child type "+l);i.appendChild(s=l)}else s=Q.createTextNode(l),i.appendChild(s)}return i!=e&&(r?e.insertBefore(i,e.firstChild):e.appendChild(i)),s}function c(e,t){if(null==t)return Q.createTextNode("");var n;try{n=t.valueOf(new i(e))}catch(r){n=r.stack}var o=Q.createTextNode(n);return t.notifies&&A(X,{element:e,textNode:o,variable:t}),o}function l(e,t,n){t&&t.notifies?(A(z,{name:n,variable:t,element:e}),(J[e.tagName]||"SELECT"===e.tagName)&&y(e,t,n)):"SELECT"===e.tagName&&"value"===n?z.prototype.renderSelectValueUpdate(t,e):z.prototype.renderUpdate(t,e)}function f(){}function p(e,t,n){t&&t.notifies?A(K,{name:n,variable:t,element:e}):e.setAttribute(n,t)}function h(e){var t=n.compose(q,function(e){q.apply(this,arguments)},{renderUpdate:e});return function(n,r,i){n[i];for(var o in r){var a=r[o];a&&a.notifies?A(t,{name:o,variable:a,element:n}):e(a,n,o)}}}function d(e,t){for(var n in t){var r=t[n],i=$[n];re[n]?re[n](e,r,n,t):(i=$[n])&&void 0===e[n]?r&&r.notifies?A(G,{name:n,variable:r,element:e}):i(e,r,n):r&&r.notifies?A(q,{name:n,variable:r,element:e}):"function"==typeof r&&"on"===n.slice(0,2)?e.addEventListener(n.slice(2),r):e[n]=r}}function v(e,t,n,r){var i=e.each||r.each;if(i&&t){if(i.create){var o=e.itemAs||pe;P(i,o,function(e){var n=o["for"](e._item);return n.collection=t,n})}if(t.notifies)A(Y,{each:i,variable:t,element:e});else{var a=Q.createDocumentFragment();t.forEach(function(t){i.create?childElement=i.create({parent:e,_item:t}):childElement=i(t,e),a.appendChild(childElement)}),e.appendChild(a)}}else J[e.tagName]?m(e,t):t instanceof Array?(e=e.contentNode||e,u(e,t,e)):e.appendChild(c(e,t))}function y(t,r,o,a){n.nextTurn(function(){for(var n=t.inputEvents||["change","alkali-change"],s=0,u=n.length;s<u;s++)t.addEventListener(n[s],function(n){var s=t[o],u=r.put(a?a(s,t):s,new i(t));if(u===e.deny)throw new Error("Variable change denied")})})}function g(e,t){return"number"==t.type?parseFloat(e):e}function m(e,t){var n=e.type,r=n in{date:1,datetime:1,time:1}?"valueAsDate":"checkbox"===n||"radio"===n?"checked":"value";t&&t.notifies?(A(z,{variable:t,name:r,element:e}),y(e,t,r,g)):e[r]=t}function b(e,t){var n=t._applyOnCreate;t.prototype;if(e&&"object"==typeof e)if(e instanceof Array||e.notifies)n.content=e;else for(var r in e)ae[r]?P(t,e[r]):n[r]=e[r];else{if("function"==typeof e&&!e["for"])throw new TypeError("Function as argument not supported");n.content=e}}function O(e){if(e.hasOwnProperty("_applyOnCreate"))return e._applyOnCreate;if(e.getForClass){applyOnCreate=e._applyOnCreate={};var t=O(ne(e));for(var n in t)applyOnCreate[n]=t[n];for(var i=e.prototype,o=Object.getOwnPropertyNames(i),a=0,s=o.length;a<s;a++){var n=o[a];"on"===n.slice(0,2)||"render"===n&&r(i[n])?applyOnCreate[n]=i[n]:"render"===n.slice(0,6)&&Object.defineProperty(i,n[6].toLowerCase()+n.slice(7),w(n))}return applyOnCreate}return null}function w(e){var t=new WeakMap;return{get:function(){return t.has(this)?t.get(this):null},set:function(n){t.set(this,n),this[e](n)}}}function j(){function e(t,n){return this instanceof e?V.apply(e.prototype===ne(this)?e:this.constructor,arguments):x.apply(e,arguments)}return e.create=V,e["with"]=x,e["for"]=R,e.property=I,e.getForClass=N,e}function x(e,t){var n=j();n.superConstructor=this,n.tagName=this.tagName,this.children&&(n.children=this.children);var r=(n.prototype=this.prototype,n._applyOnCreate={}),i=O(this);for(var o in i)r[o]=i[o];var a=0;if("string"==typeof e){var s=e.match(H);if(s){do{var u=s[1],c=s[2];"."==u?r.className?r.className+=" "+c:r.className=c:r.id=c;var l=s[3];s=l&&l.match(H)}while(s)}else r.content=e;a++}for(var f=arguments.length;a<f;a++)b(arguments[a],n);return n}function V(e,t){var n=O(this);if(oe){var r=oe;oe=null}var i=Q.createElement(this.tagName);if(e&&e.parent&&(r=e.parent),r&&ee.set(i,r),i instanceof this||te(i,this.prototype),i.constructor!=this&&(i.constructor=this),arguments.length>0){var o=n;n={};for(var a in o)n[a]=o[a];var s=0;if("string"==typeof e){s++;var c=e.match(H);if(c){do{var l=c[1],f=c[2];"."==l?n.className?n.className+=" "+f:i.className?i.className+=" "+f:i.className=f:n.id?n.id=f:i.id=f;var p=c[3];c=p&&p.match(H)}while(c)}else n.content=e}else e&&e._item&&(i._item=e._item);for(var h=arguments.length;s<h;s++){var y=arguments[s];if(y instanceof Array||y.notifies)n.content=y;else if("function"==typeof y&&y["for"])n.content=y["for"](i);else for(var a in y)n[a]=y[a]}}return d(i,n),this.children&&u(i,this.children,i),n.content&&v(i,n.content,"content",n),i.createdCallback&&i.createdCallback(),i.created&&i.created(n),i}function C(e){return this.nodeType?u(this,arguments,this):u(e,se.call(arguments,1),e)}function k(e){return this.nodeType?u(this,arguments,this,!0):u(e,se.call(arguments,1),e,!0)}function T(e){this.tagName=e,Q.registerElement&&this.prototype.constructor===this&&Q.registerElement(e,this)}function S(e){return e=e.toLowerCase(),ce[e]||(ce[e]=_(x.call(Q.createElement(e).constructor),e))}function _(e,t){return e.tagName=t,e}function E(e){e.forEach(function(e){var t;Object.defineProperty(ue,e,{get:function(){return t||(t=S(e))}})})}function M(e){e.forEach(function(e){var t;Object.defineProperty(ue,e,{get:function(){return t||(t=_(x.call(HTMLInputElement,{type:e.toLowerCase()}),"input"))}}),Object.defineProperty(ue,e+"Input",{get:function(){return this[e]}})})}function R(e){return e.constructor.getForClass(e,this)}function P(e,t,n){if("object"==typeof t&&t.Class)return P(e,t.Class,t.createInstance);if(t instanceof Array)return t.forEach(function(t){P(e,t)});var r=e.ownedClasses||(e.ownedClasses=new WeakMap);return r.set(t,n||function(){return new t}),e}function N(e,t){for(var n;e&&!(n=e.constructor.ownedClasses&&e.constructor.ownedClasses.get(t));)e=e.parentNode||ee.get(e);if(n){var r=e.ownedInstances||(e.ownedInstances=new WeakMap),i=r.get(t);return void 0===i&&(r.set(t,i=n(e)),i.subject=e),i}}function I(t){return ThisElementVariable=this._Variable,ThisElementVariable||(ThisElementVariable=this._Variable=e(),P(this,ThisElementVariable,function(e){var t=new ThisElementVariable(e);return t.observeObject(),t})),ThisElementVariable.property(t)}function A(e,t){var n=t.element,r=n.updaters||(n.updaters=[]);r.push(new e(t))}function L(e){var t=e.updaters;if(t){for(var n=0,r=t.length;n<r;n++)t[n].stop();e.needsRestart=!0}}function F(e){var t=e.updaters;if(t)for(var n=0,r=t.length;n<r;n++);}function D(e){var t=e.constructor;t.create&&(e.attached&&e.attached(),e.needsRestart&&F(e))}function U(e){e.detached&&e.detached(),L(e)}function W(e,t){if("attached"===t.name)return!e.__alkaliAttached__&&(e.__alkaliAttached__=!0,t.action(e),!0);if(e.__alkaliAttached__){if(he.contains(e))return!1;e.__alkaliAttached__=!1,t.action(e)}return!0}var B={};["textContent","innerHTML","title","href","value","valueAsNumber","role","render"].forEach(function(e){B[e]=!0});var H=/(\.|#)([-\w]+)(.+)?/,q=t.PropertyRenderer,z=t.InputPropertyRenderer,K=t.AttributeRenderer,G=n.compose(t.StyleRenderer,function(){t.StyleRenderer.apply(this,arguments)},{renderUpdate:function(e,t){var n=$[this.name];n?n(t,e,this.name):t.style[this.name]=e}}),Z=n.compose(t.ElementRenderer,function(e){this.className=e.className,t.apply(this,arguments)},{renderUpdate:function(e,t){var n=t.className,r=this.className,i=n&&(" "+n+" ").replace(" "+r+" "," ");r=e?n?(i+r).slice(1):r:i.slice(1,i.length-1),r!=n&&(t.className=r)}}),X=t.TextRenderer,Y=t.ListRenderer,Q="undefined"!=typeof document?document:{createElement:function(e){return{}},addEventListener:function(){}},J=(Q.createElement("div").style,{INPUT:1,TEXTAREA:1}),$={display:o(["initial","none"]),visibility:o(["visible","hidden"]),color:s,opacity:s,zoom:s,minZoom:s,maxZoom:s,fontWeight:s,position:o(["absolute",""]),textDecoration:o(["underline",""]),fontWeight:o(["bold","normal"])};["alignContent","alignItems","alignSelf","animation","animationDelay","animationDirection","animationDuration","animationFillMode","animationIterationCount","animationName","animationPlayState","animationTimingFunction","backfaceVisibility","background","backgroundAttachment","backgroundBlendMode","backgroundClip","backgroundColor","backgroundImage","backgroundOrigin","backgroundPosition","backgroundPositionX","backgroundPositionY","backgroundRepeat","backgroundRepeatX","backgroundRepeatY","backgroundSize","baselineShift","border","borderBottom","borderBottomColor","borderBottomLeftRadius","borderBottomRightRadius","borderBottomStyle","borderBottomWidth","borderCollapse","borderColor","borderImage","borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth","borderLeft","borderLeftColor","borderLeftStyle","borderLeftWidth","borderRadius","borderRight","borderRightColor","borderRightStyle","borderRightWidth","borderSpacing","borderStyle","borderTop","borderTopColor","borderTopLeftRadius","borderTopRightRadius","borderTopStyle","borderTopWidth","borderWidth","bottom","boxShadow","boxSizing","bufferedRendering","captionSide","clear","clip","clipPath","clipRule","color","colorInterpolation","colorInterpolationFilters","colorRendering","counterIncrement","counterReset","cursor","direction","display","emptyCells","fill","fillOpacity","fillRule","filter","flex","flexBasis","flexDirection","flexFlow","flexGrow","flexShrink","flexWrap","float","floodColor","floodOpacity","font","fontFamily","fontFeatureSettings","fontKerning","fontSize","fontStretch","fontStyle","fontVariant","fontVariantLigatures","fontWeight","height","imageRendering","isolation","justifyContent","left","letterSpacing","lightingColor","lineHeight","listStyle","listStyleImage","listStylePosition","listStyleType","margin","marginBottom","marginLeft","marginRight","marginTop","marker","markerEnd","markerMid","markerStart","mask","maskType","maxHeight","maxWidth","maxZoom","minHeight","minWidth","minZoom","mixBlendMode","motion","motionOffset","motionPath","motionRotation","objectFit","objectPosition","opacity","order","orientation","orphans","outline","outlineColor","outlineOffset","outlineStyle","outlineWidth","overflow","overflowWrap","overflowX","overflowY","padding","paddingBottom","paddingLeft","paddingRight","paddingTop","page","pageBreakAfter","pageBreakBefore","pageBreakInside","paintOrder","perspective","perspectiveOrigin","pointerEvents","position","quotes","resize","right","shapeImageThreshold","shapeMargin","shapeOutside","shapeRendering","size","speak","src","stopColor","stopOpacity","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","tabSize","tableLayout","textAlign","textAlignLast","textAnchor","textCombineUpright","textDecoration","textIndent","textOrientation","textOverflow","textRendering","textShadow","textTransform","top","touchAction","transform","transformOrigin","transformStyle","transition","transitionDelay","transitionDuration","transitionProperty","transitionTimingFunction","unicodeBidi","unicodeRange","userZoom","vectorEffect","verticalAlign","visibility","whiteSpace","widows","width","willChange","wordBreak","wordSpacing","wordWrap","writingMode","zIndex","zoom"].forEach(function(e){$[e]=$[e]||a});var ee=new WeakMap,te=Object.setPrototypeOf||function(e,t){e.__proto__=t},ne=Object.getPrototypeOf||function(e){return e.__proto__},re=(new WeakMap(null,"invalidated"),{content:f,children:f,tagName:f,each:f,classes:function(e,t){if(!(t.length>-1)){var n=0;for(var r in t)t[n]||(t[n]=r),n++;t.length=n}for(var n=0,i=t.length;n<i;n++){var o=t[n],a=t[o];a&&a.notifies?A(Z,{element:e,className:o,variable:a}):(a||void 0===a)&&(e.className+=" "+o)}},"class":p,"for":p,role:p,render:function(t,n,r,i){A(q,{name:r,variable:new e.GeneratorVariable(n.bind(t,i)),element:t})},value:l,valueAsNumber:l,valueAsDate:l,checked:l,dataset:h(function(e,t,n){t.dataset[n||this.name]=e}),attributes:h(function(e,t,n){t.setAttribute(n||this.name,e)}),style:function(e,t,n){"string"==typeof t?e.setAttribute("style",t):t&&t.notifies?A(K,{name:"style",variable:t,elment:e}):ie(e,t,n)}}),ie=h(function(e,t,n){t.style[n||this.name]=e});nextClassId=1,uniqueSelectors={},Q.addEventListener("click",function(e){var t=e.target;if("radio"===t.type)for(var n=Q.querySelectorAll("input[type=radio]"),r=0,i=n.length;r<i;r++){var o=n[r];o.name===t.name&&o!==t&&o.dispatchEvent(new Event("alkali-change",{}))}});var oe,ae={hasOwn:function(e,t){P(e,t)}},se=[].slice,ue=x.call("undefined"!=typeof HTMLElement?HTMLElement:function(){});ue.registerTag=T,ue.within=function(e){},E(["Video","Source","Media","Audio","UL","Track","Title","TextArea","Template","TBody","THead","TFoot","TR","Table","Col","ColGroup","TH","TD","Caption","Style","Span","Shadow","Select","Script","Quote","Progress","Pre","Picture","Param","P","Output","Option","Optgroup","Object","OL","Ins","Del","Meter","Meta","Menu","Map","Link","Legend","Label","LI","KeyGen","Input","Image","IFrame","H1","H2","H3","H4","H5","H6","Hr","FrameSet","Frame","Form","Font","Embed","Article","Aside","Footer","Figure","FigCaption","Header","Main","Mark","MenuItem","Nav","Section","Summary","WBr","Div","Dialog","Details","DataList","DL","Canvas","Button","Base","Br","Area","A"]),M(["Checkbox","Password","Submit","Radio","Color","Date","DateTime","Email","Month","Number","Range","Search","Tel","Time","Url","Week"]);var ce={},le={Anchor:"A",Paragraph:"P",Textarea:"TextArea",DList:"DL",UList:"UL",OList:"OL",ListItem:"LI",Text:"Input",TextInput:"Input",TableRow:"TR",TableCell:"TD",TableHeaderCell:"TH",TableHeader:"THead",TableBody:"TBody"};for(var fe in le)!function(e,t){Object.defineProperty(ue,e,{get:function(){return this[t]}})}(fe,le[fe]);ue.append=C,ue.prepend=k,ue.refresh=t.refresh;ue.options={moveLiveElementsEnabled:!0};ue.content=function(e){return{isContentNode:!0,create:e.create.bind(e)}},ue.extend=function(e,t){function n(){return e.apply(this,arguments)}te(n,e);var r=n.prototype=Object.create(e.prototype);return r.constructor=n,Object.getOwnPropertyNames(t).forEach(function(e){var i=Object.getOwnPropertyDescriptor(t,e);ae[e]?ae[e](n,i.value):Object.defineProperty(r,e,i)}),n};var pe=ue.Item=e.Item;if("function"==typeof MutationObserver){var he=Q.body,de=[{name:"detached",nodes:"removedNodes",action:U},{name:"attached",nodes:"addedNodes",action:D}],ve=new MutationObserver(function(e){for(var t=0,n=e.length;t<n;t++)for(var r=e[t],i=0,o=de.length;i<o;i++){var a=de[i],s=r[a.nodes];e:for(var u=0,c=s.length;u<c;u++){var l=s[u];if(W(l,a)){var f=l.firstChild;if(f)for(;;){var p;if(1===f.nodeType&&W(f,a)?(p=f.firstChild,p||(p=f.nextSibling)):p=f.nextSibling,!p)do if(f=f.parentNode,f===l)continue e;while(!(p=f.nextSibling));f=p}}}}});ve.observe(he,{childList:!0,subtree:!0})}return ue}.apply(t,r),!(void 0!==i&&(e.exports=i))},function(e,t,n){var r,i;r=[n(3)],i=function(e){function t(e){for(var t=1,n=arguments.length;t<n;t++){var r=arguments[t];r!==e&&(!e||r&&e.contains&&e.contains(r))&&(e=r)}return e}function n(e,t){var n=t&&(t.distinctSubject||t.subject);if("function"==typeof e)return e["for"](n);var r=e.contextMap;if(t&&r){for(;n&&!r.has(n);)n=n.parentNode;return n||(n=q),r.get(n)}}function r(e,t){return e&&e.then?e.then(t):t(e)}function i(e){this.subject=e}function o(t,n){for(var r,i=0,o=t.length;i<o;i++)t[i]&&t[i].then&&(r=!0);return r?e.whenAll(t,n):n(t)}function a(e,t){var n=P.get(e),r=t.listenerId||(t.listenerId="-"+N++);n?void 0===n[r]&&(n[r]=n.push(t)-1):(P.set(e,n=[t]),n[r]=0,p.autoObserveObjects&&observe(e)),t.listeningToObject=e}function s(e){if(e.listeningToObject){var t=e.listeningToObject;e.listeningToObject=null;var n=P.get(t);if(n){var r=n[e.listenerId];r>-1&&(n.splice(r,1),delete n[e.listenerId])}}}function u(){this.visited=new Set}function c(e,t,n){this.key=e,this.childEvent=t,this.parent=n,this.visited=t.visited}function l(e){this.visited=new Set;for(var t in e)this[t]=e[t]}function f(e){this.visited=new Set;for(var t in e)this[t]=e[t]}function p(e){return this instanceof p?void(this.value="undefined"==typeof e?this["default"]:e):p.extend(e)}function h(e,t){e._willModify(),r(e.cachedValue||e.valueOf(),function(n){n||e.put(n=[]),e.updateVersion();var r=t.call(e,n);return e.cachedVersion=e.version,r})}function d(e,t,n,r){var i=t.length;if(i>0){if(e._properties)for(var o,a=r-i;a>n;){var o=e._properties[--a];o&&(e._properties[a]=void 0,o.key+=i,e._properties[o.key]=o)}for(var a=0,s=t.length;a<s;a++)e.updated(new l({value:t[a],index:a+n,modifier:e}),e)}}function v(e,t,n,r,i){var o,a=n+r;if(r>0){if(e._properties)for(var a=n+r;a<i+r;a++){var o=e._properties[a];o&&(e._properties[a]=void 0,o.key-=r,e._properties[o.key]=o)}for(var a=0;a<r;a++)e.updated(new f({previousIndex:n,oldValue:t[a],modifier:e}),e);e.cachedVersion=e.version}}function y(e){p.prototype[e]=function(){return new B(this,e,arguments)}}function g(e){p[e]=function(t){t[e]=!0}}function m(e){var t=P.get(e);if(t)for(var n=0,r=t.length;n<r;n++)t[n]._propertyChange(null,e)}function b(e){if(e.length>-1)return new F(e);if(arguments.length>1)return new F(arguments);if("object"==typeof e){var t=[],n=[];for(var r in e)t.push(r),n.push(e[r]);return new p(function(e){for(var n={},r=0;r<e.length;r++)n[t[r]]=e[r];return n}).apply(null,n)}throw new TypeError("Variable.all requires an array")}function O(e,t){var n=this.ownedClasses||(this.ownedClasses=new S);return n.set(e,t||function(){return new e}),this}function w(e,t){var n=e.constructor.ownedClasses&&e.constructor.ownedClasses.get(t);if(n){var r=e.ownedInstances||(e.ownedInstances=new S),i=r.get(t);return i||(r.set(t,i=n(e)),i.subject=e),i}}function j(){for(var e=this.prototype,t=Object.getOwnPropertyNames(e),n=0,r=t.length;n<r;n++){var i=t[n];Object.defineProperty(this,i,x(Object.getOwnPropertyDescriptor(e,i),i,this))}}function x(e,t,n){return"function"==typeof e.value?{value:V(n,t)}:e}function V(e,t){var n=e[t]=function(){var n=e["for"](this);return n[t].apply(n,arguments)};return n["for"]=function(n){var r=e["for"](n);return function(){return r[t].apply(r,arguments)}},n}function C(e,n){if(!n)throw new TypeError("Accessing a generalized class without context to resolve to an instance, call for(context) (where context is an element or related variable instance) on your variable first");var r=n.subject.constructor.getForClass&&n.subject.constructor.getForClass(n.subject,e)||e.defaultInstance;return n.distinctSubject=t(n.distinctSubject,r.subject),r}var k={},T={},S=e.WeakMap,_=Object.setPrototypeOf||function(e,t){e.__proto__=t},E=Object.getPrototypeOf||function(e){return e.__proto__},M=3,R=(Object.freeze({type:"refresh"}),1),P=new S(null,"propertyListenersMap"),N=(e.compose(S,function(){},{_propertyChange:function(e){this.variable._propertyChange(e,contextFromCache(this))}}),1);u.prototype.type="refresh",c.prototype.type="update",l.prototype.type="add",f.prototype.type="delete";var I=p.prototype={constructor:p,valueOf:function(e){if(this.subject){e=new i(this.subject)}return this.gotValue(this.getValue(e),e)},getValue:function(){return this.value},gotValue:function(e,t){var n=this.notifyingValue,i=this;if(e&&e.then)return r(e,function(e){return p.prototype.gotValue.call(i,e,t)});if(n){if(e===n)return i.ownObject||e.valueOf(t);i.dependents&&n.stopNotifies(i),i.notifyingValue=null}return e&&e.notifies&&(i.dependents&&e.notifies(i),i.notifyingValue=e,e=e.valueOf(t),i.ownObject&&(E(i.ownObject)!==e&&_(i.ownObject,e),e=i.ownObject)),void 0===e&&(e=i["default"]),e},isMap:function(){return this.value instanceof Map},property:function(e){var t=this.isMap(),n=this._properties||(this._properties=t?new Map:{}),r=t?n.get(e):n[e];return r||(r=new L(this,e),t?n.set(e,r):n[e]=r),r},"for":function(e){if(e&&e.target&&!e.constructor.getForClass&&(e=e.target),"function"==typeof this){if(void 0!==e){var t;if(e.constructor.getForClass)t=e.constructor.getForClass(e,this),t&&!t.subject&&(t.subject=e);else if(e&&"object"==typeof e){var n=this.instanceMap||(this.instanceMap=new S);t=n.get(e),t||n.set(e,t=new this(e))}else t=new this(e);return t||this.defaultInstance}return this.defaultInstance}return new U(this,e||q)},distinctFor:function(e){if("function"==typeof this)return this["for"](e);var t=this.contextMap||(this.contextMap=new S);if(t.has(e))return t.get(e);var n;return t.set(e,n=new U(this,e)),n},_propertyChange:function(e,t,n,r){this.onPropertyChange&&this.onPropertyChange(e,t,n),this.updated(new c(e,new u,this),null,n)},eachKey:function(e){for(var t in this._properties)e(t)},apply:function(e,t){return new D(this,t)},call:function(e){return this.apply(e,Array.prototype.slice.call(arguments,1))},forDependencies:function(e){this.notifyingValue&&e(this.notifyingValue)},init:function(){this.subject&&this.constructor.notifies(this);var e=this;this.forDependencies(function(t){t.notifies(e)}),null===this.listeningToObject&&this.valueOf()},cleanup:function(){var e=this.handles;if(e)for(var t=0;t<e.length;t++)e[t].remove();this.handles=null;var n=this.notifyingValue;n&&(this.computedVariable=null);var r=this;this.forDependencies(function(e){e.stopNotifies(r)}),this.context&&this.constructor.stopNotifies(this)},updateVersion:function(e){this.version=R++},getVersion:function(e){return Math.max(this.version||0,this.notifyingValue&&this.notifyingValue.getVersion?this.notifyingValue.getVersion(e):0)},getSubject:function(e){return this.subject},getUpdates:function(e){var t=[],n=this.nextUpdateMap;if(n&&e)for(;e=n.get(e);)"refresh"===e.type&&(t=[]),t.push(e);return t},updated:function(e,t,r){if(e||(e=new u),!e.visited.has(this)){if(e.visited.add(this),this.subject){if(t!==this.constructor)return this.constructor.updated(e,this,new i(this.subject));if(r&&(r.distinctSubject||r.subject)!==this.subject&&!(r.subject.contains&&this.subject.nodeType&&r.subject.contains(this.subject)))return}var o=n(this,r);if(o&&o.updated(e,this,r),this.lastUpdate){var a=this.nextUpdateMap;a||(a=this.nextUpdateMap=new S),a.set(this.lastUpdate,e)}this.lastUpdate=e,this.updateVersion();var s=(this.value,this.dependents);if(s){s=s.slice(0);for(var l=0,f=s.length;l<f;l++)try{var p=s[l];e instanceof c&&p instanceof L?p.key===e.key&&p.updated(e.childEvent,this,r):p.updated(e,this,r)}catch(h){console.error(h,h.stack,"updating a variable")}}return e instanceof c&&(this.notifyingValue&&this.fixed&&this.notifyingValue.updated(e,this,r),this.collection&&this.collection.updated(e,this,r)),e}},invalidate:function(){this.updated()},notifies:function(e){var t=this.dependents;t&&this.hasOwnProperty("dependents")||(this.dependents=t=[],this.init()),t.push(e);var n=this;return{unsubscribe:function(){n.stopNotifies(e)}}},subscribe:function(t){var n,r,i=this;if("function"==typeof t){var i=this,o={value:function(){return i.valueOf()}};n=function(){r=!1,t(o)}}else{if(!t.next)throw new Error("Subscribing to an invalid listener, the listener must be a function, or have an update or next method");n=function(){r=!1,t.next(i.valueOf())}}var a=this.notifies({updated:function(){r||(r=!0,e.nextTurn(n))}}),s=this.valueOf();return void 0!==s&&n(),a},stopNotifies:function(e){var t=this.dependents;if(t){for(var n=0;n<t.length;n++)t[n]===e&&t.splice(n--,1);0===t.length&&(this.dependents=t=!1,this.cleanup())}},put:function(e,t){var n=this;return this.ownObject&&(this.ownObject=!1),r(this.getValue(t),function(i){return i===e?T:n.fixed&&i&&i.put?i.put(e):r(n.setValue(e,t),function(e){n.updated(new u,n,t)})})},get:function(e){return r(this.valueOf(),function(t){var n=t&&("function"==typeof t.get?t.get(e):t[e]);return n&&n.notifies?n.valueOf():n})},set:function(e,t){this.property(e).put(t)},undefine:function(e,t){this.set(e,void 0,t)},proxy:function(e){var t=this;return this.fixed=!0,r(this.setValue(e),function(e){t.updated(new u,t)})},next:function(e){this.put(e)},error:function(e){var t=this.dependents;if(t){t=t.slice(0);for(var n=0,r=t.length;n<r;n++)try{var i=t[n];i.error(e)}catch(o){console.error(o,"sending an error")}}},complete:function(e){this.put(e)},setValue:function(e){this.value=e},onValue:function(t){return this.subscribe(function(n){e.when(n.value(),function(e){t(e)})})},forEach:function(e,t,n){if(e.notifies){var i=this;this.forEach(function(n){var r=e["for"](n);r.collection=i,t.call(this,r)},n)}return r(this.valueOf(t),function(t){if(t&&t.forEach)t.forEach(e);else for(var n in t)e.call(t,t[n],n)})},to:function(e,t){if("function"!=typeof e)throw"object"==typeof e&&this.to(e.forward,e.reverse),new Error("No function provided to transform");return t&&(e.reverse=function(e,n,r){t.call(this,n[0],r)}),new D(e,[this])},get schema(){return this.notifyingValue?this.notifyingValue.schema:this.constructor},set schema(e){Object.defineProperty(this,"schema",{value:e})},validate:function(e,t){if(this.notifyingValue)return this.notifyingValue.validate(e,t);if(t.type&&t.type!==typeof e)return["Target type of "+typeof e+" does not match schema type of "+t.type];var n=[];return n.isValid=!0,n},get validation(){var e=new H(this);return Object.defineProperty(this,"validation",{value:e}),e},set validation(e){Object.defineProperty(this,"validation",{value:e})},getId:function(){return this.id||(this.id=R++)},observeObject:function(){var t=this;return r(this.valueOf(),function(n){var r=P.get(n);if(r||P.set(n,r=[]),r.observerCount)r.observerCount++;else{r.observerCount=1;var i=r.observer=e.observe(n,function(e){for(var t=0,i=r.length;t<i;t++)for(var o=r[t],a=0,s=e.length;a<s;a++){var u=e[a];o._propertyChange(u.name,n)}});if(i.addKey)for(var o=0,u=r.length;o<u;o++){var c=r[o];c.eachKey(function(e){i.addKey(e)})}}return a(n,t),{remove:function(){s(n,t),--r.observerCount||r.observer.remove()},done:function(){e.deliverChanges(i),this.remove()}}})},_willModify:function(e){if(this.fixed&&this.value&&this.value._willModify)return this.value._willModify(e);if(!this.ownObject&&this.value&&this.value.notifies){var t=this;return r(this.valueOf(e),function(e){e&&"object"==typeof e&&(e instanceof Array?t.ownObject=e.slice(0):t.ownObject=Object.create(e))})}},splice:function(e,t){var n=arguments;return h(this,function(r){var i=r.splice.apply(r,n);return v(this,i,e,t,r.length),d(this,[].slice.call(n,2),e,r.length),i})},push:function(){var e=arguments;return h(this,function(t){var n=t.push.apply(t,e);return d(this,e,t.length-e.length,t.length),n})},unshift:function(){var e=arguments;return h(this,function(t){var n=t.unshift.apply(t,e);return d(this,e,0,t.length),n})},pop:function(){return h(this,function(e){var t=e.pop();return v(this,[t],e.length,1),t})},shift:function(){return h(this,function(e){var t=e.shift();return v(this,[t],0,1,e.length),t})}};"undefined"!=typeof Symbol&&(p.prototype[Symbol.iterator]=function(){return this.valueOf()[Symbol.iterator]()});var A=p.Caching=e.compose(p,function(e,t){e&&(this.getValue=e),t&&(this.setValue=t)},{valueOf:function(e){function r(n){n&&n.notifies&&s.dependents&&(s.computedVariable=n),n=s.gotValue(n,a);var r;return a&&a.distinctSubject?((s.contextMap||(s.contextMap=new S)).set(a.distinctSubject,r=new U(s,a.distinctSubject)),e.distinctSubject=t(e.distinctSubject,a.distinctSubject)):r=s,r.cachedVersion=u,r.cachedValue=n,n}if(this.cachedVersion===this.getVersion()){if(!this.contextMap)return this.cachedValue;var o=n(this,e);if(o)return o.cachedValue}var a,s=this;e&&(a=new i(e.subject));var u=this.getVersion(),c=this.getValue(a);return c&&c.then?c.then(r):r(c)}}),L=e.compose(p,function(e,t){this.parent=e,this.key=t},{forDependencies:function(e){p.prototype.forDependencies.call(this,e),e(this.parent)},valueOf:function(e){function t(e){if(i.dependents){var t=P.get(e);t&&t.observer&&t.observer.addKey&&t.observer.addKey(n)}var r=i.gotValue(null==e?void 0:"function"==typeof e.get?e.get(n):e[n]);return r}var n=this.key,i=this,o=this.parent.valueOf(e);return o&&o.then?r(o,t):t(o)},put:function(e,t){return this._changeValue(t,M,e)},parentUpdated:function(e,t){return p.prototype.updated.call(this,e,this.parent,t)},updated:function(e,t,n){(e=p.prototype.updated.call(this,e,t,n))&&this.parent.updated(new c(this.key,e,this.parent),this,n)},_changeValue:function(e,t,n){var i=this.key,o=this.parent,a=this;return o._willModify(e),r(o.valueOf(e),function(r){if(null==r){o.put(r="number"==typeof i?[]:{},e)}else if("object"!=typeof r)return k;if(t==M){var s="function"==typeof r.get?r.get(i):r[i];if(s===n)return T;"function"==typeof r.set?r.set(i,n):r[i]=n}a.updated(null,a,e);var u=P.get(r);if(u){u=u.slice(0);for(var c=0,l=u.length;c<l;c++){var f=u[c];f!==o&&f._propertyChange(i,r,e,t)}}})},_willModify:function(){return this.parent._willModify(),p.prototype._willModify.call(this)},validate:function(e,t){return this.parent.validate(e.valueOf(),t)}});Object.defineProperty(L.prototype,"schema",{get:function(){var e=this.parent.schema.properties;return e&&e[this.key]},set:function(e){Object.defineProperty(this,"schema",{value:e})}}),p.Property=L;var F=(p.Item=e.compose(p,function(e,t){this.value=e,this.collection=t},{}),p.Composite=e.compose(A,function(e){this.args=e},{forDependencies:function(e){A.prototype.forDependencies.call(this,e);for(var t=this.args,n=0,r=t.length;n<r;n++){var i=t[n];i&&i.notifies&&e(i)}},updated:function(e,t,n){var r=this.args;if(t!==this.notifyingValue&&e&&"refresh"!==e.type)for(var i=0,o=r.length;i<o;i++){var a=r[i];a!==t||(e=new u)}return A.prototype.updated.call(this,e,t,n)},getUpdates:function(e){if(!e||e.version<getVersion())return[new u]},getVersion:function(e){for(var t=this.args,n=p.prototype.getVersion.call(this,e),r=0,i=t.length;r<i;r++){var o=t[r];o&&o.getVersion&&(n=Math.max(n,o.getVersion(e)))}return n},getValue:function(e){for(var t=[],n=this.args,r=0,i=n.length;r<i;r++){var a=n[r];t[r]=a&&a.valueOf(e)}return o(t,function(e){return e})}})),D=e.compose(F,function(e,t){this.functionVariable=e,this.args=t},{fixed:!0,forDependencies:function(e){F.prototype.forDependencies.call(this,e),this.functionVariable.notifies&&e(this.functionVariable)},getValue:function(e){var t=this.functionVariable.valueOf(e);if(t.then){var n=this;return t.then(function(t){return n.invoke(t,n.args,e)})}return this.invoke(t,this.args,e)},getVersion:function(e){var t=F.prototype.getVersion.call(this,e);return this.functionVariable.getVersion?Math.max(t,this.functionVariable.getVersion(e)):t},execute:function(e){var t=this;return r(this.functionVariable.valueOf(e),function(n){return t.invoke(n,t.args,e,!0)})},put:function(e,t){var n=this;return r(this.valueOf(t),function(i){return i===e?T:r(n.functionVariable.valueOf(t),function(r){return n.invoke(function(){return r.reverse?(r.reverse.call(n,e,n.args,t),p.prototype.put.call(n,e,t)):i&&i.put?i.put(e):k},n.args,t)})})},invoke:function(e,t,n,i){
var a=this.functionVariable.parent;if(e.handlesContext)return e.apply(a,t,n);for(var s=[],u=0,c=t.length;u<c;u++){var l=t[u];s[u]=l&&l.valueOf(n)}return a=a&&a.valueOf(n),e.handlesPromises?e.apply(a,s,n):(s.push(a),o(s,function(t){if(i){for(var o=[],a=0,s=t.length;a<s;a++){var u=t[a];u&&"object"==typeof u&&o.push(observe(u))}var c=t.pop();try{var l=e.apply(c,t,n)}finally{r(l,function(){for(var e=0;e<s;e++)o[e].done()})}return l}var c=t.pop();return e.apply(c,t,n)}))},setReverse:function(e){return this.functionVariable.valueOf().reverse=e,this}});p.Call=D;var U=e.compose(p,function(e,t){this.constructor=e,this.subject=t},{valueOf:function(){return this.constructor.valueOf(new i(this.subject))},put:function(e){return this.constructor.put(e,new i(this.subject))},parentUpdated:function(e,t){this.constructor.updated(e,this.parent,this.context)}});y("filter"),y("map"),y("reduce"),y("reduceRight"),y("some"),y("every"),y("slice");var W,B=e.compose(F,function(e,t,n){this.source=e,this.method=t,this.args=n},{getValue:function(e){var t=this.method,n=this.args,i=this;return r(this.source.valueOf(e),function(r){if(r&&r.forEach){if(i.dependents){var o;if(e){var a=i.contextMap||(i.contextMap=new S);a.has(e.distinctSubject)?o=a.get(e.distinctSubject):a.set(e.distinctSubject,o=new U(i,e.distinctSubject))}else o=i}}else{if("map"===t)return n[0](r);r=[r]}return r[t].apply(r,n)})},updated:function(e,t,n){if(!e||e.modifier===this||e.modifier&&e.modifier.constructor===this)return F.prototype.updated.call(this,e,t,n);var r="refresh"===e.type?e:this[this.method+"Updated"]?this[this.method+"Updated"](e,n):new u;r&&F.prototype.updated.call(this,r,t,n)},filterUpdated:function(e,t){var r=n(this,t)||this;if("delete"===e.type){var i=r.cachedValue.indexOf(e.oldValue);i>-1&&r.splice(i,1)}else{if("add"!==e.type){if("update"===e.type){var o=e.parent.valueOf(t),i=r.cachedValue.indexOf(o),a=[o].filter(this.args[0]).length>0;if(i>-1){if(a)return{type:"updated",object:o,index:i};r.splice(i,1)}else a&&r.push(o);return}return e}[e.value].filter(this.args[0]).length>0&&r.push(e.value)}},mapUpdated:function(e,t){var r=n(this,t)||this;if("delete"===e.type)r.splice(e.previousIndex,1);else if("add"===e.type)r.push(this.args[0].call(this.args[1],e.value));else{if("update"!==e.type)return e;var i=e.parent.valueOf(t),o=r.cachedValue.indexOf(i);[i].filter(this.args[0]).length>0;r.splice(o,1,this.args[0].call(this.args[1],e.value))}},forDependencies:function(e){F.prototype.forDependencies.call(this,e),e(this.source)},getVersion:function(e){return Math.max(F.prototype.getVersion.call(this,e),this.source.getVersion(e))}}),H=(p.GeneratorVariable=e.compose(p.Composite,function(e){this.generator=e,this.args=[]},{getValue:W=function(e,t){var n,r,i,o;t?(i=t.iterator,r=t.i,n=t.value,o=t.isThrowing):(r=0,i=this.generator());for(var a=this.args;;){var s=i[o?"throw":"next"](n);if(s.done)return s.value;var u=s.value;if(a[r]!==u&&(a[r]&&a[r].stopNotifies(this),u&&u.notifies?(u.notifies(this),this.args[r]=u):this.args[r]=null),r++,n=u&&u.valueOf(e),n&&n.then){var c=this;return n.then(function(t){return W.call(c,e,{i:r,iterator:i,value:t})},function(t){return W.call(c,e,{i:r,iterator:i,value:t,isThrowing:!0})})}}}}),e.compose(A,function(e){this.target=e},{forDependencies:function(e){A.prototype.forDependencies.call(this,e),e(this.target)},getVersion:function(e){return Math.max(p.prototype.getVersion.call(this,e),this.target.getVersion(e))},getValue:function(e){var t=this.target;return t.validate(t,t.schema)}}));p.deny=k,p.noChange=T,g(p,"handlesContext"),g(p,"handlesPromises");var q={name:"Default context",description:"This object is the default context for classes, corresponding to a singleton instance of that class",constructor:{getForClass:function(e,t){return t.defaultInstance}},contains:function(){return!0}};for(var z in I)Object.defineProperty(p,z,Object.getOwnPropertyDescriptor(I,z));return p.valueOf=function(e){return C(this,e).valueOf()},p.setValue=function(e,t){return C(this,t).put(e)},p.getForClass=w,p.generalize=j,p.call=Function.prototype.call,p.apply=Function.prototype.apply,p.extend=function(e){function t(){return this instanceof t?n.apply(this,arguments):t.extend(e)}var n=this,r=t.prototype=Object.create(this.prototype);t.prototype.constructor=t,_(t,this);for(var i in e){var o=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(r,i,o),Object.defineProperty(t,i,x(o,i,t))}return e&&e.hasOwn&&O.call(t,e.hasOwn),t},Object.defineProperty(p,"defaultInstance",{get:function(){return this.hasOwnProperty("_defaultInstance")?this._defaultInstance:(this._defaultInstance=new this,this._defaultInstance.subject=q,this._defaultInstance)}}),p.hasOwn=O,p.all=b,p.objectUpdated=m,p.observe=function(){throw new Error("Use variable.observeObject() instead")},p}.apply(t,r),!(void 0!==i&&(e.exports=i))},function(e,t,n){var r,i;r=[],i=function(){function e(e){return a[e]}function t(e,t,n){var r;for(var i in e)e.hasOwnProperty(i)&&e[i]!==t[i]&&(e[i]=t[i](r||(r=[])).push({name:i}));for(var i in t)t.hasOwnProperty(i)&&!e.hasOwnProperty(i)&&(e[i]=t[i](r||(r=[])).push({name:i}));r&&n(r)}function n(){return n}var r,i=Object.getPrototypeOf||function(e){return e.__proto__},o=Object.setPrototypeOf||function(e,t){e.__proto__=t},a={requestAnimationFrame:"undefined"!=typeof requestAnimationFrame,defineProperty:Object.defineProperty&&function(){try{return Object.defineProperty({},"t",{}),!0}catch(e){}}(),promise:"undefined"!=typeof Promise,MutationObserver:"undefined"!=typeof MutationObserver,WeakMap:"function"==typeof WeakMap},s=e("defineProperty")?function(e,t){function n(n){var r="key"+n;if(!this[r]){this[r]=!0;var o,a=e[n],s=e;do o=Object.getOwnPropertyDescriptor(s,n);while(!o&&(s=i(s)));if(o&&o.set){var u=o.set,c=o.get;Object.defineProperty(e,n,{get:function(){return a=c.call(this)},set:function(e){u.call(this,e),a!==e&&(a=e,t&&t([{target:this,name:n}]))},enumerable:o.enumerable})}else Object.defineProperty(e,n,{get:function(){return a},set:function(e){a!==e&&(a=e,t&&t([{target:this,name:n}]))},enumerable:!o||o.enumerable})}}return t.addKey=n,t.remove=function(){t=null},t}:function(e,n){p||(p=!0,setInterval(function(){for(var e=0,n=c.length;e<n;e++)t(l[e],c[e],f[e])},20));var r={};for(var i in e)e.hasOwnProperty(i)&&(r[i]=e[i]);c.push(e),l.push(r),f.push(n)},u=e("observe")?Object.unobserve:function(e,t){t.remove&&t.remove();for(var n=0,r=c.length;n<r;n++)if(c[n]===e&&f[n]===t)return c.splice(n,1),l.splice(n,1),void f.splice(n,1)},c=[],l=[],f=[],p=!1,h=1,d=function(){};d.prototype.toJSON=n;var v={requestAnimationFrame:e("requestAnimationFrame")?requestAnimationFrame:function(){function e(){for(var e=0;e<n.length;e++)n[e]();n=[],r=!1}function t(t){r||(setTimeout(e),r=!0),n.push(t)}var n=[],r=!1;return t}(),Promise:e("promise")?Promise:function(){function e(t){function n(e){e&&e.then?e.then(n,r):(a=e,i())}function r(e){s=e,i()}function i(){o=!0;for(var e=0,t=u.length;e<t;e++)u[e]();u=0}var o,a,s,u=0;return t(n,r),{then:function(t,n){return new e(function(e,r){function i(){try{s&&!n?r(s):e(s?n(s):t?t(a):a)}catch(i){r(i)}}o?i():(u||(u=[])).push(i)})}}}return e}(),WeakMap:e("WeakMap")?WeakMap:function(t,n){var r="__"+(n||"")+h++;return e("defineProperty")?{get:function(e){return e[r]},set:function(e,t){Object.defineProperty(e,r,{value:t,enumerable:!1})}}:{get:function(e){var t=e[r];return t&&t.value},set:function(e,t){var n=e[r]||(e[r]=new d);n.value=t}}},observe:s,unobserve:u,when:function(e,t,n){return e&&e.then?e.then(t,n)||e:t(e)},whenAll:function(e,t){for(var n,r=0,i=e.length;r<i;r++)e[r]&&e[r].then&&(n=!0);return n?{then:function(n,r){function i(){s--,s||(o=n(t(u)))}for(var o,a,s=1,u=[],c=0;c<e.length;c++){var l=e[c];s++,l&&l.then?!function(e,t){a=l.then(function(n){return u[e]=n,i(),s?t:o},r)}(c,a):(u[c]=l,i())}return i(),a},inputs:e}:t(e)},compose:function(e,t,n){var r=t.prototype=Object.create(e.prototype);o(t,e);for(var i in n)r[i]=n[i];return r.constructor=t,t},nextTurn:e("MutationObserver")?function(e){var t=document.createElement("div"),n=new MutationObserver(e);n.observe(t,{attributes:!0}),t.setAttribute("a",h++)}:function(e){setTimeout(e,0)},copy:Object.assign||function(e,t){for(var n in t)e[n]=t[n];return e}};return v}.apply(t,r),!(void 0!==i&&(e.exports=i))},function(e,t,n){var r,i;r=[n(3)],i=function(e,t){function n(e){this.subject=e}function r(e){var t=e.variable;if(this.variable=t,this.elements=[],e){e.selector&&(this.selector=e.selector),e.elements&&(this.elements=e.elements,this.element=this.elements[0]),e.element&&(this.element=e.element,this.elements.push(e.element));for(var n=0,r=this.elements.length;n<r;n++)(this.elements[n].alkaliRenderers||(this.elements[n].alkaliRenderers=[])).push(this);e.update&&(this.updateRendering=e.update),e.shouldRender&&(this.shouldRender=e.shouldRender),e.renderUpdate&&(this.renderUpdate=e.renderUpdate),e.alwaysUpdate&&(this.alwaysUpdate=e.alwaysUpdate)}if(t.updated)t.notifies(this);else{var i=this;t.subscribe(function(e){i.variable={valueOf:function(){return e.value()}},i.updated()})}e&&e.updateOnStart!==!1&&this.updateRendering(!0)}function i(e){r.call(this,e)}function o(e){e.name&&(this.name=e.name),i.apply(this,arguments)}function a(e){e.name&&(this.name=e.name),i.apply(this,arguments)}function s(e){e.element&&"SELECT"===e.element.tagName&&"value"===e.name&&(this.renderUpdate=this.renderSelectValueUpdate),a.apply(this,arguments)}function u(e){e.name&&(this.name=e.name),i.apply(this,arguments)}function c(e){i.apply(this,arguments)}function l(e){this.position=e.position,this.textNode=e.textNode,i.apply(this,arguments)}function f(e){e.each&&(this.each=e.each),i.apply(this,arguments)}function p(e){if(e.alkaliRenderers)for(var t=e.alkaliRenderers,n=0;n<t.length;n++){var r=t[n];r.variable.stopNotifies(r)}}var h,d,v=("undefined"!=typeof document&&document,[]),y=1,g=e.requestAnimationFrame;return r.prototype={constructor:r,updateRendering:function(){throw new Error("updateRendering must be implemented by sub class of Renderer")},updated:function(e,t,n){if(!this.invalidated&&(!n||this.contextMatches(n))){this.invalidated=!0;var r=this;g(function(){h=null,r.updateRendering(r.alwaysUpdate)})}},contextMatches:function(e){return!0},invalidateElement:function(t){h||(h=new WeakMap(null,"invalidated"));var n=h.get(t);h.set(t,n={}),n[id]||(n[id]=!0),d||(e.queueTask(processQueue),d=!0);var r=this;v.push(function(){r.invalidated=!1,r.updateElement(t)})},getId:function(){return this.id||(this.id=y++)},stop:function(){this.variable.stopNotifies(this)}},i.prototype=Object.create(r.prototype),i.prototype.shouldRender=function(e){return document.body.contains(e)},i.prototype.getSubject=function(){return this.element||this.elements[0]},i.prototype.updateRendering=function(e,t){var n=this.elements||t&&[t]||[];if(!n.length){if(!this.selector)throw new Error("No element or selector was provided to the Renderer");return void(n=document.querySelectorAll(this.selector))}for(var r=0,i=n.length;r<i;r++)if(e||this.shouldRender(n[r]))this.updateElement(n[r]);else{var o=this.getId(),a=n[r].renderersOnShow;a||(a=n[r].renderersOnShow=[],n[r].className+=" needs-rerendering"),a[o]||(a[o]=this)}},i.prototype.addElement=function(e){this.selector?e.renderersOnShow=[this]:this.elements.push(e),this.updateElement(e)},i.prototype.updateElement=function(e){this.invalidated=!1;try{var t=!this.omitValueOf&&this.variable.valueOf(new n(e))}catch(r){e.appendChild(document.createTextNode(r))}if(void 0!==t||this.started)if(this.started=!0,t&&t.then){this.renderLoading&&this.renderLoading(t,e);var i=this;t.then(function(t){i.renderUpdate(t,e)})}else this.renderUpdate(t,e)},i.prototype.renderUpdate=function(e,t){throw new Error("renderUpdate(newValue) must be implemented")},r.Renderer=r,r.ElementRenderer=i,o.prototype=Object.create(i.prototype),o.prototype.type="AttributeRenderer",o.prototype.renderUpdate=function(e,t){t.setAttribute(this.name,e)},r.AttributeRenderer=o,a.prototype=Object.create(i.prototype),a.prototype.type="PropertyRenderer",a.prototype.renderUpdate=function(e,t){t[this.name]=e},r.PropertyRenderer=a,s.prototype=Object.create(a.prototype),s.prototype.type="InputPropertyRenderer",s.prototype.renderUpdate=function(e,t){"number"===t.type&&isNaN(e)&&(e=""),t[this.name]=e},s.prototype.renderSelectValueUpdate=function(t,n){n.value=t,n.value==t||n.value?n.eventualValue=void 0:(n.eventualValue=t,e.nextTurn(function(){n.eventualValue&&(n.value=n.eventualValue,n.eventualValue=void 0)}))},r.InputPropertyRenderer=s,u.prototype=Object.create(i.prototype),u.prototype.type="StyleRenderer",u.prototype.renderUpdate=function(e,t){t.style[this.name]=e},r.StyleRenderer=u,c.prototype=Object.create(i.prototype),c.prototype.type="ContentRenderer",c.prototype.renderUpdate=function(e,t){t.innerHTML="",void 0===e&&(e=""),t.appendChild(document.createTextNode(e))},r.ContentRenderer=c,l.prototype=Object.create(i.prototype),l.prototype.type="TextRenderer",l.prototype.renderUpdate=function(e,t){void 0===e&&(e=""),(this.textNode||t.childNodes[this.position]).nodeValue=e},r.TextRenderer=l,f.prototype=Object.create(i.prototype),f.prototype.updated=function(e,t){(this.updates||(this.updates=[])).push(e),i.prototype.updated.call(this,e,t)},f.prototype.type="ListRenderer",f.prototype.omitValueOf=!0,f.prototype.renderUpdate=function(e,t){function n(e,t,n){var a;a=i.create?i.create({parent:o,_item:e}):i(e,o),n?(r.insertBefore(a,n),s.splice(t,0,a)):(r.appendChild(a),s.push(a))}var r,i=this.each,o=this.elements[0],a=this;if(this.builtList){var s=this.childElements,u=this.updates;r=this.element,u.forEach(function(e){if("refresh"===e.type){a.builtList=!1;for(var t=0,r=s.length;t<r;t++)o.removeChild(s[t]);a.renderUpdate()}else if(e.previousIndex>-1&&(o.removeChild(s[e.previousIndex]),s.splice(e.previousIndex,1)),e.index>-1){var i=s[e.index]||null;n(e.value,e.index,i)}}),this.updates=[]}else{this.builtList=!0,r=document.createDocumentFragment();var s=this.childElements=[];this.variable["for"](o).forEach(function(e){n(e)}),this.element.appendChild(r)}},r.ListRenderer=f,r.onShowElement=function(e){g(function(){h=null;var t=[].slice.call(e.getElementsByClassName("needs-rerendering"));if(e.className.indexOf("needs-rerendering")>0){var n=[e];n.push.apply(n,t),t=n}for(var r=0,i=t.length;r<i;r++){var o=t[r],a=o.renderersOnShow;if(a){o.renderersOnShow=null,o.className=o.className.replace(/\s?needs\-rerendering\s?/g,"");for(var s in a){var u=a[s];u.updateElement(o)}}}})},r.onElementRemoval=function(e,t){t||p(e);for(var n=e.getElementsByTagName("*"),r=0,i=n.length;r<i;r++){var o=n[r];o.alkaliRenderers&&p(o)}},r}.apply(t,r),!(void 0!==i&&(e.exports=i))},function(e,t,n){var r,i;r=[n(3),n(2)],i=function(e,t){function n(e,n){return n&&n.reverse&&(e.reverse=n.reverse),new t.GeneratorVariable(e)}return n}.apply(t,r),!(void 0!==i&&(e.exports=i))},function(e,t,n){var r,i;r=[n(2)],i=function(e){function t(e){return i[e]||(i[e]=new Function("a","b","deny","return "+e))}function n(n,i,a,s,u,c){function l(e){e.precedence=a,e.infix=c!==!1}var f=function(e,t){var n=t[0],i=t[1];if(n&&n.put){var o=u(e,i&&i.valueOf());o!==r&&n.put(o)}else{if(!i||!i.put)return r;i.put(c(e,n&&n.valueOf()))}},p={apply:function(i,a){return s=t(s),u=u&&t(u),c=c&&t(c),s.reverse=f,o[n]=p=new e(s),l(p),a=Array.prototype.slice.call(a),a.push(r),p.apply(i,a)}};l(p),o[n]=p,o[i]=function(){return p.apply(null,arguments)}}var r=e.deny,i={},o={};return n("+","add",6,"a+b","a-b","a-b"),n("-","subtract",6,"a-b","a+b","b-a"),n("*","multiply",5,"a*b","a/b","a/b"),n("/","divide",5,"a/b","a*b","b/a"),n("?","if",16,"b[a?0:1]","a===b[0]||(a===b[1]?false:deny)","[a,b]"),n(":","choose",15,"[a,b]","a[0]?a[1]:deny","a[1]"),n("!","not",4,"!a","!a",!1),n("%","remainder",5,"a%b"),n(">","greater",8,"a>b"),n(">=","greaterOrEqual",8,"a>=b"),n("<","less",8,"a<b"),n("<=","lessOrEqual",8,"a<=b"),n("==","equal",9,"a===b"),n("&","and",8,"a&&b"),n("|","or",8,"a||b"),n("round","round",8,"Math.round(a*Math.pow(10,b||1))/Math.pow(10,b||1)","a","a"),o}.apply(t,r),!(void 0!==i&&(e.exports=i))},function(e,t,n){var r,i;r=[n(3),n(2)],i=function(e,t){function n(e,t,r){if(e&&"object"==typeof e){if(e instanceof Array){t=[];for(var i=0,o=e.length;i<o;i++)t[i]=n(e[i],null,r)}else{t&&"object"==typeof t||(t=r&&r.get(e),t||(t={},r&&r.set(e,t)));for(var i in e)t[i]=n(e[i],t[i],r)}return t}return e}var r=e.compose(t,function(n){this.copiedFrom=n,this.derivativeMap=new e.WeakMap(null,"derivative"),this.isDirty=new t((!1))},{valueOf:function(e){this.state&&(this.state=null);var t=this.copiedFrom.valueOf(e);if(t&&"object"==typeof t){var r=this.derivativeMap.get(t);return null==r&&(this.derivativeMap.set(t,r=n(t,void 0,this.derivativeMap)),this.setValue(r,e)),r}var i=this.getValue(e);return void 0===i?t:i},getCopyOf:function(e){var t=this.derivativeMap.get(e);return null==t&&this.derivativeMap.set(e,t=n(e,void 0,this.derivativeMap)),t},save:function(){var e=this.copiedFrom.valueOf(),t=n(this.valueOf(),e);e!==t?this.copiedFrom.put&&this.copiedFrom.put(t):this.copiedFrom.notifies&&this.copiedFrom.updated&&this.copiedFrom.updated(),this.isDirty.put(!1),this.onSave&&this.onSave()},revert:function(){var e=this.copiedFrom.valueOf();this.put(n(e,this.derivativeMap.get(e),this.derivativeMap)),this.isDirty.put(!1)},updated:function(){return this.isDirty.put(!0),t.prototype.updated.apply(this,arguments)}});return r}.apply(t,r),!(void 0!==i&&(e.exports=i))}])});
//# sourceMappingURL=index.js.map