!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.alkali=t():e.alkali=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var r,i,o;!function(a,s){i=[n(1),n(3),n(5),n(7),n(6),n(4),n(2)],r=s,o="function"==typeof r?r.apply(t,i):r,!(void 0!==o&&(e.exports=o))}(this,function(e,t,n,r,i,o,a){var s=Object.create(e);return s.Copy=r,s.Element=e,a.copy(s,o),s.react=n,s.spawn=a.spawn,s.Renderer=t.ElementRenderer,a.copy(s,t),a.copy(s,i),s["default"]=void 0,s})},function(e,t,n){var r,i,o;!function(a,s){i=[n(2),n(3),n(4)],r=s,o="function"==typeof r?r.apply(t,i):r,!(void 0!==o&&(e.exports=o))}(this,function(e,t,n){function r(e){return function(t,n,r){"string"!=typeof n&&(n=e[n?0:1]),t.style[r]=n}}function i(e,t,n){"number"==typeof t&&(t+="px"),e.style[n]=t}function o(e,t,n){e.style[n]=t}function a(e,t,n,r){for(var i=t.length>1||r?$.createDocumentFragment():e,o=0,u=t.length;o<u;o++){var c,l=t[o];if(null!=l)if(l.create)fe=e,c=l.create(),i.appendChild(c),l.isContentNode&&(n.contentNode=c);else if(l.notifies){var f=l.isIterable?i:e;i.appendChild(c=s(f,l))}else if("object"==typeof l)if(l instanceof Array)n=n||e,c=c||e,a(c.contentNode||c,l,n);else{if(!l.nodeType)throw new Error("Unknown child type "+l);i.appendChild(c=l)}else c=$.createTextNode(l),i.appendChild(c)}return i!=e&&(r?e.insertBefore(i,e.firstChild):e.appendChild(i)),c}function s(e,t){if(null==t)return $.createTextNode("");var n;if(t.notifies){n=$.createTextNode("");var r=new X({element:e,textNode:n,variable:t});n=r.textNode}else n=$.createTextNode(t);return n}function u(e,t,n){t&&t.notifies?(new G({name:n,variable:t,element:e}),(ee[e.tagName]||"SELECT"===e.tagName)&&v(e,t,n)):"SELECT"===e.tagName&&"value"===n?G.prototype.renderSelectValueUpdate(t,e):("number"===e.type&&isNaN(t)&&(t=""),e[n]=t)}function c(){}function l(e,t,n){t&&t.notifies?new Y({name:n,variable:t,element:e}):e.setAttribute(n,t)}function f(t){var n=e.compose(K,function(e){K.apply(this,arguments)},{renderUpdate:t});return function(e,r,i){for(var o in r){var a=r[o];a&&a.notifies?new n({name:o,variable:a,element:e}):t(a,e,o)}}}function p(e,t){var n=e._propertyHandlers,r=e.constructor;for(var i in t){var o=t[i],a=r[i];"function"==typeof a&&a.notifies&&a!==o&&(M(r,a),a["for"](e).put(o));var s,u=n[i];u?u===!0?o&&o.notifies?new K({name:i,variable:o,element:e}):e[i]=o:u(e,o,i,t):(s=ie[i])?o&&o.notifies?new J({name:i,variable:o,element:e}):s(e,o,i):null==e[i]?e[i]=o:"function"==typeof o&&"on"===i.slice(0,2)?e.addEventListener(i.slice(2),o):Object.defineProperty(e,i,{value:o,enumerable:!0,configurable:!0,writable:!0})}}function h(e,t){var r,i,o,a=t._generators,s=e._propertyHandlers;for(var u in a){var c=new n.GeneratorVariable(a[u].bind(e,t));s[u]?(o||(o={}))[u]=c:ie[u]?(i||(i={}))[u]=c:(r||(r={}))[u]=c}r&&p(e,r),i&&p(e,i),o&&p(e,o)}function d(e,t,n,r){var i=e.each||r.each;if(i&&t)if(i.create&&(i.defineHasOwn=function(){var e=t.getCollectionOf&&t.getCollectionOf()||ge;M(i,e,function(t){var n=e.from(t._item);return n})}),t.notifies)new Q({each:i,variable:t,element:e});else{var o=$.createDocumentFragment();i.defineHasOwn&&i.defineHasOwn(),t.forEach(function(t){i.create?childElement=i.create({parent:e,_item:t}):childElement=i(t,e),o.appendChild(childElement)}),e.appendChild(o)}else ee[e.tagName]?m(e,t):t instanceof Array?(e=e.contentNode||e,a(e,t,e)):e.appendChild(s(e,t))}function v(t,r,i,o){e.nextTurn(function(){for(var e=t.inputEvents||["change","alkali-change"],a=0,s=e.length;a<s;a++)t.addEventListener(e[a],function(e){var a=t[i],s=r.put(o?o(a,t):a,new q(t));if(s===n.deny)throw new Error("Variable change denied")})})}function y(e,t){return"number"==t.type?parseFloat(e):e}function m(e,t){var n=e.type,r=n in{date:1,datetime:1,time:1}?"valueAsDate":"checkbox"===n||"radio"===n?"checked":"value";t&&t.notifies?(new G({variable:t,name:r,element:e}),v(e,t,r,y)):e[r]=t}function g(e,t,n,r){var i=r[n];if(i)for(var o in t)i[o]=t[o];else r[n]=t}function b(e,t){var n=t._applyOnCreate;if(e&&"object"==typeof e)if(e instanceof Array||e.notifies)n.content=e;else for(var r in e){var i=e[r],o=t[r];"function"==typeof i?i.notifies?(i===W&&(i=W()),t[r]=i):z(i)&&("get_"===r.slice(0,4)&&(r=r.slice(4)),(n._generators||(n._generators={}))[r]=i):i&&i.notifies&&(t[r]=i),pe[r]?pe[r](t,i,r,n):"function"==typeof o&&o.notifies?n[r]=new o(i):n[r]=i}else{if("function"==typeof e&&!e["for"])throw new TypeError("Function as argument not supported");n.content=e}}function w(e){if(e.hasOwnProperty("_applyOnCreate"))return e._applyOnCreate;if(e.getForClass){var t=e._applyOnCreate={},n=w(se(e));for(var r in n)t[r]=pe[r]?Object.create(n[r]):n[r];for(var i,o=e.prototype,a=Object.getOwnPropertyNames(o),s=0,u=a.length;s<u;s++){var r=a[s];if("on"===r.slice(0,2)||"render"===r&&z(o[r]))t[r]=o[r];else if("render"===r.slice(0,6)){var c=r[6].toLowerCase()+r.slice(7);i||(i=o._propertyHandlers=Object.create(o._propertyHandlers)),i[c]=!0,Object.defineProperty(o,c,O(r))}}return t}return null}function O(e){var t=new WeakMap;return{get:function(){return t.has(this)?t.get(this):null},set:function(n){t.set(this,n),this[e](n)}}}function _(){function e(t,n){return this instanceof e?j.apply(e.prototype===se(this)?e:this.constructor,arguments):x.apply(e,arguments)}return e}function x(e,t){var n=_();this["with"]?(ae(n,this),n.ownedClasses=null):(n.create=j,n["with"]=x,n["for"]=N,n.property=R,n.getForClass=A),n.prototype=this.prototype;var r=n._applyOnCreate={},i=w(this);for(var o in i)r[o]=pe[o]?Object.create(i[o]):i[o];var a=0;if("string"==typeof e){var s=e.match(H);if(s){do{var u=s[1],c=s[2];"."==u?r.className?r.className+=" "+c:r.className=c:r.id=c;var l=s[3];s=l&&l.match(H)}while(s)}else r.content=e;a++}for(var f=arguments.length;a<f;a++)b(arguments[a],n);return n}function j(e,t){var n=w(this);if(fe){var r=fe;fe=null}var i=$.createElement(this.tagName);if(e&&e.parent&&(r=e.parent),r&&oe.set(i,r),i instanceof this||ae(i,this.prototype),i.constructor!=this&&(te?Object.defineProperty(i,"constructor",{value:this}):i.constructor=this),arguments.length>0){var o=n;n={};for(var s in o)n[s]=pe[s]?Object.create(o[s]):o[s];var u=0;if("string"==typeof e){u++;var c=e.match(H);if(c){do{var l=c[1],f=c[2];"."==l?n.className?n.className+=" "+f:i.className?i.className+=" "+f:i.className=f:n.id?n.id=f:i.id=f;var v=c[3];c=v&&v.match(H)}while(c)}else n.content=e}else e&&e._item&&(i._item=e._item);for(var y=arguments.length;u<y;u++){var m=arguments[u];if(m&&"object"==typeof m)if(m instanceof Array||m.notifies)n.content=m;else for(var s in m)pe[s]?pe[s](this,m[s],s,n):n[s]=m[s];else"function"==typeof m&&m["for"]?n.content=m["for"](i):n.content=m}}return i.created?n=i.created(n)||n:n.created&&(n=n.created.call(i,n)||n),p(i,n),n._generators&&h(i,n),this.children&&a(i,this.children,i),this.shadow&&a(i.attachShadow({mode:"open"}),this.shadow,i),null!=i.content&&d(i,i.content,"content",n),i.ready&&i.ready(n),i}function C(e){return this.nodeType?a(this,arguments,this):a(e,he.call(arguments,1),e)}function E(e){return this.nodeType?a(this,arguments,this,!0):a(e,he.call(arguments,1),e,!0)}function S(t,n){var r=n.tagName;n.tagName=t,"object"==typeof customElements?customElements.define(t,e.extendClass(HTMLElement),{"extends":r}):console.warn("This browser does not support customElements, ensure that the constructor is used to create new elements")}function V(e){return e=e.toLowerCase(),ve[e]||(ve[e]=P(x.call($.createElement(e).constructor),e))}function P(e,t){var n=ce[t];if(n&&!n.assigned){for(var r=e.prototype._propertyHandlers=Object.create(ue),i=0,o=n.length;i<o;i++)r[n[i]]=!0;if(n.value)for(var i in n)i>-1||(r[i]=n[i]);n.assigned=!0}return e.tagName=t,e}function T(e){e.forEach(function(e){var t;Object.defineProperty(de,e,{get:function(){return t||(t=V(e))}})})}function k(e){e.forEach(function(e){var t;Object.defineProperty(de,e,{get:function(){return t||(t=P(x.call(HTMLInputElement,{type:e.toLowerCase()}),"input"))}}),Object.defineProperty(de,e+"Input",{get:function(){return this[e]}})})}function N(e){return e.constructor.getForClass(e,this)}function M(e,t,n){if("object"==typeof t){var r=e.ownedClasses||(e.ownedClasses=new WeakMap),i={get:function(){return t}};return r.set(t.constructor,i),M(e,t.Class,t.createInstance)}if(t instanceof Array)return t.forEach(function(t){M(e,t)});var r=e.ownedClasses||(e.ownedClasses=new WeakMap);if(!r.has(t)){var i=new WeakMap;i.createInstance=n,r.set(t,i)}return e}function A(e,t){for(var n;e&&!(n=e.constructor.ownedClasses&&e.constructor.ownedClasses.get(t));)e=e.parentNode||oe.get(e);if(n){var r=e.ownedInstances||(e.ownedInstances=new WeakMap),i=r.get(t);return void 0===i&&(r.set(t,i=n(e)),i.subject=e),i}}function R(e){return ThisElementVariable=this._Variable,ThisElementVariable||(ThisElementVariable=this._Variable=W(),M(this,ThisElementVariable,function(e){var t;if(e.alkaliRenderers){for(var n={},r=0;r<e.alkaliRenderers.length;r++){var i=e.alkaliRenderers[r];i.name&&(n[i.name]={value:i.variable})}t=Object.create(e,n)}else t=e;var o=new ThisElementVariable(t);return o})),ThisElementVariable.property(e)}function I(e){var t=e.alkaliRenderers;if(t){for(var n=0,r=t.length;n<r;n++)t[n].stop();e.needsRestart=!0}}function D(e){var t=e.alkaliRenderers;if(t)for(var n=0,r=t.length;n<r;n++);}function L(e){var t=e.constructor;t.create&&(e.attached&&e.attached(),e.needsRestart&&D(e))}function F(e){e.detached&&e.detached(),I(e)}function B(e,t){if("attached"===t.name)return!e.__alkaliAttached__&&(e.__alkaliAttached__=!0,t.action(e),!0);if(e.__alkaliAttached__){if($.body.contains(e))return!1;e.__alkaliAttached__=!1,t.action(e)}return!0}var W=n.Variable,U=["textContent","id","className","innerHTML","title","lang","translate","dir","tabIndex","accessKey","draggable","spellcheck","contentEditable","innerText","webkitdropzone"],H=/^(\.|#)([-\w]+)(.+)?/,z=e.isGenerator,q=n.Context,K=t.PropertyRenderer,G=t.InputPropertyRenderer,Y=t.AttributeRenderer,J=e.compose(t.StyleRenderer,function(){t.StyleRenderer.apply(this,arguments)},{renderUpdate:function(e,t){var n=ie[this.name];n?n(t,e,this.name):t.style[this.name]=e}}),Z=e.compose(t.ElementRenderer,function(e){this.className=e.className,t.apply(this,arguments)},{renderUpdate:function(e,t){var n=t.className,r=this.className,i=n&&(" "+n+" ").replace(" "+r+" "," ");r=e?n?(i+r).slice(1):r:i.slice(1,i.length-1),r!=n&&(t.className=r)}}),X=t.TextRenderer,Q=t.ListRenderer,$="undefined"!=typeof document?document:{createElement:function(e){return{}},addEventListener:function(){}},ee={INPUT:1,TEXTAREA:1},te=!1,ne=$.createElement("font"),re=ne.constructor;ne.constructor=function(){},$.createElement("font").constructor==ne.constructor&&(ne.__proto__.constructor=re,te=!0);var ie={display:r(["","none"]),visibility:r(["visible","hidden"]),color:o,opacity:o,zoom:o,minZoom:o,maxZoom:o,fontWeight:o,position:r(["absolute",""]),textDecoration:r(["underline",""]),fontWeight:o};["alignContent","alignItems","alignSelf","animation","animationDelay","animationDirection","animationDuration","animationFillMode","animationIterationCount","animationName","animationPlayState","animationTimingFunction","backfaceVisibility","background","backgroundAttachment","backgroundBlendMode","backgroundClip","backgroundColor","backgroundImage","backgroundOrigin","backgroundPosition","backgroundPositionX","backgroundPositionY","backgroundRepeat","backgroundRepeatX","backgroundRepeatY","backgroundSize","baselineShift","border","borderBottom","borderBottomColor","borderBottomLeftRadius","borderBottomRightRadius","borderBottomStyle","borderBottomWidth","borderCollapse","borderColor","borderImage","borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth","borderLeft","borderLeftColor","borderLeftStyle","borderLeftWidth","borderRadius","borderRight","borderRightColor","borderRightStyle","borderRightWidth","borderSpacing","borderStyle","borderTop","borderTopColor","borderTopLeftRadius","borderTopRightRadius","borderTopStyle","borderTopWidth","borderWidth","bottom","boxShadow","boxSizing","bufferedRendering","captionSide","clear","clip","clipPath","clipRule","color","colorInterpolation","colorInterpolationFilters","colorRendering","counterIncrement","counterReset","cursor","direction","display","emptyCells","fill","fillOpacity","fillRule","filter","flex","flexBasis","flexDirection","flexFlow","flexGrow","flexShrink","flexWrap","float","floodColor","floodOpacity","font","fontFamily","fontFeatureSettings","fontKerning","fontSize","fontStretch","fontStyle","fontVariant","fontVariantLigatures","fontWeight","height","imageRendering","isolation","justifyContent","left","letterSpacing","lightingColor","lineHeight","listStyle","listStyleImage","listStylePosition","listStyleType","margin","marginBottom","marginLeft","marginRight","marginTop","marker","markerEnd","markerMid","markerStart","mask","maskType","maxHeight","maxWidth","maxZoom","minHeight","minWidth","minZoom","mixBlendMode","motion","motionOffset","motionPath","motionRotation","objectFit","objectPosition","opacity","order","orientation","orphans","outline","outlineColor","outlineOffset","outlineStyle","outlineWidth","overflow","overflowWrap","overflowX","overflowY","padding","paddingBottom","paddingLeft","paddingRight","paddingTop","page","pageBreakAfter","pageBreakBefore","pageBreakInside","paintOrder","perspective","perspectiveOrigin","pointerEvents","position","quotes","resize","right","shapeImageThreshold","shapeMargin","shapeOutside","shapeRendering","size","speak","src","stopColor","stopOpacity","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","tabSize","tableLayout","textAlign","textAlignLast","textAnchor","textCombineUpright","textDecoration","textIndent","textOrientation","textOverflow","textRendering","textShadow","textTransform","top","touchAction","transform","transformOrigin","transformStyle","transition","transitionDelay","transitionDuration","transitionProperty","transitionTimingFunction","unicodeBidi","unicodeRange","userZoom","vectorEffect","verticalAlign","visibility","whiteSpace","widows","width","willChange","wordBreak","wordSpacing","wordWrap","writingMode","zIndex","zoom"].forEach(function(e){ie[e]=ie[e]||i});var oe=new WeakMap,ae=Object.setPrototypeOf||function(e,t){e.__proto__=t},se=Object.getPrototypeOf||function(e){return e.__proto__},ue={children:c,tagName:c,_generators:c,classes:function(e,t){if(!(t.length>-1)){var n=0;for(var r in t)t[n]||(t[n]=r),n++;t.length=n}for(var n=0,i=t.length;n<i;n++){var o=t[n],a=t[o];a&&a.notifies?new Z({element:e,className:o,variable:a}):(a||void 0===a)&&(e.className+=" "+o)}},"class":l,"for":l,role:l,render:function(e,t,r,i){new K({name:r,variable:new n.GeneratorVariable(t.bind(e,i)),element:e})},dataset:f(function(e,t,n){t.dataset[n||this.name]=e}),attributes:f(function(e,t,n){t.setAttribute(n||this.name,e)}),style:function(e,t,n){"string"==typeof t?e.setAttribute("style",t):t&&t.notifies?new Y({name:"style",variable:t,element:e}):le(e,t,n)}};U.forEach(function(e){ue[e]=!0}),"undefined"!=typeof HTMLElement&&(HTMLElement.prototype._propertyHandlers=ue);var ce={input:e.copy(["accept","alt","autocomplete","autofocus","capture","defaultChecked","dirName","disabled","form","files","formAction","formEnctype","formMethod","formNoValidate","formTarget","indeterminate","inputMode","list","max","maxLength","min","minLength","multiple","name","pattern","placeholder","readOnly","required","size","src","step","type","defaultValue","willValidate","validity","validationMessage","useMap","autocapitalize","webkitdirectory","incremental","stepUp","stepDown"],{value:u,valueAsNumber:u,valueAsDate:u,checked:u,type:function(e,t){try{e.type=t}catch(n){}}}),select:e.copy(["name","size","type","selectedIndex","validationMessage"],{value:u}),textarea:e.copy(["cols","dirName","maxLength","minLength","name","placeholder","rows","wrap","type","defaultValue","textLength","validationMessage","autocapitalize"],{value:u}),a:["target","download","ping","rel","hreflang","type","referrerPolicy","href","media"],area:["target","download","coords","rel","hreflang","type","referrerPolicy","href","media","alt","shape"],button:["formAction","formEnctype","formMethod","formTarget","name","type","value","validationMessage"],dialog:["open"],embed:["src","type","name"],form:["acceptCharset","action","autocomplete","enctype","encoding","method","name","target","novalidate"],frame:["name","scrolling","src","frameBorder"],frameset:["cols","rows"],iframe:["src","srcdoc","name","referrerPolicy","align","scrolling","frameBorder","longDesc"],img:["src","alt","crossorigin","ismap","longdesc","sizes","srcset","usemap","referrerpolicy"],option:["label","value","text","index"],optgroup:["label"],output:["name","type","defaultValue","value","validationMessage"],label:["htmlFor"],td:["colSpan","rowSpan"],th:["colSpan","rowSpan"],script:["src","type","charset","text","event","htmlFor","integrity"],style:["media","type"],track:["kind","src","srclang","label"],link:["href","rel","media","hreflang","type","charset","rev","target","integrity","as"],meta:["name","httpEquiv","content","scheme"],meter:["value","min","max","low","high","optimum"],progress:["value","max","position"],del:["cite","dateTime"],ins:["cite","dateTime"],source:["src","type","srcset","sizes","media"],video:["videoWidth","videoHeight","poster","webkitDecodedFrameCount","webkitDroppedFrameCount"],keygen:["challenge","keytype","name","type","validationMessage"],object:["data","type","name","useMap","validationMessage","archive","code","hspace","standby","vspace","codeBase","codeType"],param:["name","value","type","valueType"]},le=f(function(e,t,n){t.style[n||this.name]=e});$.addEventListener("click",function(e){var t=e.target;if("radio"===t.type)for(var n=$.querySelectorAll("input[type=radio]"),r=0,i=n.length;r<i;r++){var o=n[r];o.name===t.name&&o!==t&&o.dispatchEvent(new Event("alkali-change",{}))}});var fe,pe={classes:g,_generators:g,dataset:g,attributes:g,style:g,hasOwn:function(e,t){M(e,t)},children:function(e,t){e.children=t},shadow:function(e,t){e.shadow=t}},he=[].slice,de=x.call("undefined"!=typeof HTMLElement?HTMLElement:function(){});de.defineTag=S,de.assign=function(e,t){return"function"!=typeof e?p(e,t):(w(e),void b(t,e))},de.within=function(e){},T(["Video","Source","Media","Audio","UL","U","Track","Title","TextArea","Template","TBody","THead","TFoot","TR","Table","Col","ColGroup","TH","TD","Caption","Sup","Sub","Style","Strong","Span","Small","Shadow","Select","Script","S","Quote","Progress","Pre","Picture","Param","P","Output","Option","Optgroup","Object","OL","Ins","I","Del","Meter","Meta","Menu","Map","Link","Legend","Label","LI","KeyGen","Input","Img","IFrame","H1","H2","H3","H4","H5","H6","Hr","FrameSet","Frame","Form","Font","Embed","Em","Code","Cite","Dfn","B","Article","Aside","Abbr","Footer","Figure","FigCaption","Header","Main","Mark","MenuItem","Nav","Section","Slot","Summary","WBr","Div","Dialog","Details","DataList","DL","Canvas","Button","Base","Br","Area","A"]),k(["Checkbox","Password","Submit","Radio","Color","Date","DateTime","Email","Month","Number","Range","Search","Tel","Time","Url","Week"]);var ve={},ye={Anchor:"A",Image:"Img",Paragraph:"P",Textarea:"TextArea",DList:"DL",UList:"UL",OList:"OL",ListItem:"LI",Text:"Input",TextInput:"Input",TableRow:"TR",TableCell:"TD",TableHeaderCell:"TH",TableHeader:"THead",TableBody:"TBody"};for(var me in ye)!function(e,t){Object.defineProperty(de,e,{get:function(){return this[t]}})}(me,ye[me]);de.append=C,t.append=C,de.prepend=E,de.refresh=t.refresh,de.options={moveLiveElementsEnabled:!0},de.content=function(e){return{isContentNode:!0,create:e.create.bind(e)}},de.ElementClass=function(){},"undefined"!=typeof Symbol&&Object.defineProperty(de.ElementClass,Symbol.hasInstance,{value:function(e){return e&&e.create&&e["with"]}}),de.extend=function(e,t){function n(){return e.apply(this,arguments)}ae(n,e);var r=n.prototype=Object.create(e.prototype,{constructor:{value:n}});return Object.getOwnPropertyNames(t).forEach(function(e){var i=Object.getOwnPropertyDescriptor(t,e);pe[e]?pe[e](n,i.value,e,t):Object.defineProperty(r,e,i)}),n};var ge=de.Item=n.Item;if("function"==typeof MutationObserver){var be=[{name:"detached",nodes:"removedNodes",action:F},{name:"attached",nodes:"addedNodes",action:L}],we=new MutationObserver(function(e){for(var t=0,n=e.length;t<n;t++)for(var r=e[t],i=0,o=be.length;i<o;i++){var a=be[i],s=r[a.nodes];e:for(var u=0,c=s.length;u<c;u++){var l=s[u];if(B(l,a)){var f=l.firstChild;if(f)for(;;){var p;if(1===f.nodeType&&B(f,a)?(p=f.firstChild,p||(p=f.nextSibling)):p=f.nextSibling,!p)do if(f=f.parentNode,f===l)continue e;while(!(p=f.nextSibling));f=p}}}}});we.observe($.body||$,{childList:!0,subtree:!0})}return e.copy(n.Context.prototype,{specify:function(e){var t=this.subject,n=!0;(this.generics||(this.generics=[])).push(e);do{this.distinctSubject===t&&(n=!1);var r=t.constructor.ownedClasses;if(r){var i=r.get(e);if(i)return n&&(this.distinctSubject=t),specifiedInstance=i.get(t),specifiedInstance||i.set(t,specifiedInstance=i.createInstance?i.createInstance(t):new e),specifiedInstance}}while(t=t.parentNode||oe.get(t));return e.defaultInstance},getContextualized:function(e){var t=this.subject;if(!t)return e;if(e._contextMap)do{var n=e._contextMap.get(t);if(n&&n.context.matches(t))return n}while(t=t.parentNode||oe.get(t));return e.context&&e.context.matches(this.subject)?e:void 0},merge:function(e){(!this.distinctSubject||this.distinctSubject!==e.distinctSubject&&this.distinctSubject.contains(e.distinctSubject))&&(this.distinctSubject=e.distinctSubject),[].push.apply(this.generics||(this.generics=[]),e.generics)},getDistinctElement:function(e,t){do{var n=t.constructor.ownedClasses;if(n){var r=n.get(e);if(r&&r.has(t))return t}}while(t=t.parentNode||oe.get(t))},matches:function(e){var t=this.generics;if(t)for(var n=0,r=t.length;n<r;n++)if(this.getDistinctElement(t[n],e)!==this.distinctSubject)return!1;return!0}}),de})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(e,t){__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_FACTORY__=t,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(this,function(){function has(e){return hasFeatures[e]}function queue(e,t,n){queuedListeners?queuedListeners.indexOf(e)===-1&&queuedListeners.push(e):(queuedListeners=[e],lang.nextTurn(function(){queuedListeners.forEach(function(e){var t=[];e.properties.forEach(function(n){t.push({target:e.object,name:n})}),e(t),e.object=null,e.properties=null}),queuedListeners=null},0)),e.object=t;var r=e.properties||(e.properties=[]);r.indexOf(n)===-1&&r.push(n)}function diff(e,t,n){var r;for(var i in e)e.hasOwnProperty(i)&&e[i]!==t[i]&&(e[i]=t[i](r||(r=[])).push({name:i}));for(var i in t)t.hasOwnProperty(i)&&!e.hasOwnProperty(i)&&(e[i]=t[i](r||(r=[])).push({name:i}));r&&n(r)}function toJSONHidden(){return toJSONHidden}function isGenerator(e){if("function"==typeof e){var t=e.constructor;return"GeneratorFunction"===(t.displayName||t.name)}}function spawn(e){function t(){for(;;){var e=i[r?"throw":"next"](n);if(e.done)return e.value;if(n=e.value,"function"==typeof n&&isGenerator(nextVariable)&&(n=run(n())),n&&n.then)return n.then(function(e){return n=e,t()},function(e){return n=e,r=!0,t()});r=!1}}var n,r,i="function"==typeof e?e():e;return t()}var getPrototypeOf=Object.getPrototypeOf||function(e){return e.__proto__},setPrototypeOf=Object.setPrototypeOf||function(e,t){e.__proto__=t},hasFeatures={requestAnimationFrame:"undefined"!=typeof requestAnimationFrame,defineProperty:Object.defineProperty&&function(){try{return Object.defineProperty({},"t",{}),!0}catch(e){}}(),promise:"undefined"!=typeof Promise,MutationObserver:"undefined"!=typeof MutationObserver,WeakMap:"function"==typeof WeakMap},observe=has("defineProperty")?function(e,t){function n(n){var r="key"+n;if(!this[r]){this[r]=!0;var i,o=e[n],a=e;do i=Object.getOwnPropertyDescriptor(a,n);while(!i&&(a=getPrototypeOf(a)));if(i&&i.set){var s=i.set,u=i.get;Object.defineProperty(e,n,{get:function(){return o=u.call(this)},set:function(e){s.call(this,e),o!==e&&(o=e,t&&t([{target:this,name:n}]))},enumerable:i.enumerable})}else Object.defineProperty(e,n,{get:function(){return o},set:function(e){o!==e&&(o=e,t&&t([{target:this,name:n}]))},enumerable:!i||i.enumerable})}}return t.addKey=n,t.remove=function(){t=null},t}:function(e,t){timerStarted||(timerStarted=!0,setInterval(function(){for(var e=0,t=watchedObjects.length;e<t;e++)diff(watchedCopies[e],watchedObjects[e],listeners[e])},20));var n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);watchedObjects.push(e),watchedCopies.push(n),listeners.push(t)},queuedListeners,unobserve=has("observe")?Object.unobserve:function(e,t){t.remove&&t.remove();for(var n=0,r=watchedObjects.length;n<r;n++)if(watchedObjects[n]===e&&listeners[n]===t)return watchedObjects.splice(n,1),watchedCopies.splice(n,1),void listeners.splice(n,1)},watchedObjects=[],watchedCopies=[],listeners=[],timerStarted=!1,id=1,Hidden=function(){};Hidden.prototype.toJSON=toJSONHidden;var extendClass;try{extendClass=eval("(function(Base){ return class extends Base {}})")}catch(e){}var lang={requestAnimationFrame:has("requestAnimationFrame")?requestAnimationFrame:function(){function e(){for(var e=0;e<n.length;e++)n[e]();n=[],r=!1}function t(t){r||(setTimeout(e),r=!0),n.push(t)}var n=[],r=!1;return t}(),Promise:has("promise")?Promise:function(){function e(t){function n(e){e&&e.then?e.then(n,r):(a=e,i())}function r(e){s=e,i()}function i(){o=!0;for(var e=0,t=u.length;e<t;e++)u[e]();u=0}var o,a,s,u=0;return t(n,r),{then:function(t,n){return new e(function(e,r){function i(){try{s&&!n?r(s):e(s?n(s):t?t(a):a)}catch(i){r(i)}}o?i():(u||(u=[])).push(i)})}}}return e}(),WeakMap:has("WeakMap")?WeakMap:function(e,t){var n="__"+(t||"")+id++;return has("defineProperty")?{get:function(e){return e[n]},set:function(e,t){Object.defineProperty(e,n,{value:t,enumerable:!1})}}:{get:function(e){var t=e[n];return t&&t.value},set:function(e,t){var r=e[n]||(e[n]=new Hidden);r.value=t}}},observe:observe,unobserve:unobserve,extendClass:extendClass,when:function(e,t,n){return e&&e.then?e.then(t,n)||e:t(e)},whenAll:function(e,t){for(var n,r=0,i=e.length;r<i;r++)e[r]&&e[r].then&&(n=!0);if(n){var o,a;return{then:function(n,r){function i(){c--,c||(a?s=n(o):(a=!0,s=n(o=t(l))))}for(var s,u,c=1,l=[],f=0;f<e.length;f++){var p=e[f];c++,p&&p.then?!function(e,t){u=p.then(function(n){return l[e]=n,i(),c?t:s},r)}(f,u):(l[f]=p,i())}return i(),u},inputs:e}}return t(e)},compose:function(e,t,n){var r=t.prototype=Object.create(e.prototype);setPrototypeOf(t,e);for(var i in n)r[i]=n[i];return r.constructor=t,t},nextTurn:has("MutationObserver")?function(e){var t=document.createElement("div"),n=new MutationObserver(e);n.observe(t,{attributes:!0}),t.setAttribute("a",id++)}:function(e){setTimeout(e,0)},copy:Object.assign||function(e,t){for(var n in t)e[n]=t[n];return e}};return lang.isGenerator=isGenerator,lang.spawn=spawn,lang})},function(e,t,n){var r,i,o;!function(a,s){i=[n(2),n(4)],r=s,o="function"==typeof r?r.apply(t,i):r,!(void 0!==o&&(e.exports=o))}(this,function(e,t){function n(e){var t=e.variable;if(this.variable=t,e.selector&&(this.selector=e.selector),e.elements){this.elements=e.elements,this.element=this.elements[0];for(var n=0,r=this.elements.length;n<r;n++)(this.elements[n].alkaliRenderers||(this.elements[n].alkaliRenderers=[])).push(this)}else{if(!e.element)throw new Error("No element provided to Renderer");var i=this.element=e.element;(i.alkaliRenderers||(i.alkaliRenderers=[])).push(this)}if(e.update&&(this.updateRendering=e.update),e.shouldRender&&(this.shouldRender=e.shouldRender),e.renderUpdate&&(this.renderUpdate=e.renderUpdate),e.alwaysUpdate&&(this.alwaysUpdate=e.alwaysUpdate),!t.updated){var o=this;t.subscribe(function(e){o.variable={valueOf:function(){return e.value()}},o.updated()})}if(e.updateOnStart===!1){this.variable.valueOf(this);var a=this.contextualized||this.variable;a.notifies(this)}else this.updateRendering(!0)}function r(e){n.call(this,e)}function i(e){e.name&&(this.name=e.name),r.apply(this,arguments)}function o(e){e.name&&(this.name=e.name),r.apply(this,arguments)}function a(e){e.element&&"SELECT"===e.element.tagName&&"value"===e.name&&(this.renderUpdate=this.renderSelectValueUpdate),o.apply(this,arguments)}function s(e){e.name&&(this.name=e.name),r.apply(this,arguments)}function u(e){r.apply(this,arguments)}function c(e){this.position=e.position,this.textNode=e.textNode,r.apply(this,arguments)}function l(e){e.each&&(this.each=e.each),r.apply(this,arguments)}function f(e){if(e.alkaliRenderers)for(var t=e.alkaliRenderers,n=0;n<t.length;n++){var r=t[n];r.variable.stopNotifies(r)}}var p,h,d=("undefined"!=typeof document&&document,[]),v=1,y=e.requestAnimationFrame,m=t.Context;return n.prototype={constructor:n,version:2166136261,updateRendering:function(){throw new Error("updateRendering must be implemented by sub class of Renderer")},updated:function(e,t,n){if(!this.invalidated&&(!n||this.contextMatches(n))){this.invalidated=!0,this.deferredRender&&(this.deferredRender.isCanceled=!0,this.deferredRender=null);var r=this;y(function(){p=null,r.updateRendering(r.alwaysUpdate)})}},hash:function(){},newContext:function(){return new m(this.element)},integrate:function(e,t){this.addInput(t)},addInput:function(e){this.variable!==e&&(this.contextualized=e)},getContextualized:function(){return this.contextualized||this.variable},specify:function(e){return this.newContext().specify(e)},merge:function(){},contextMatches:function(e){return!0},invalidateElement:function(t){p||(p=new WeakMap(null,"invalidated"));var n=p.get(t);p.set(t,n={}),n[id]||(n[id]=!0),h||(e.queueTask(processQueue),h=!0);var r=this;d.push(function(){r.invalidated=!1,r.updateElement(t)})},getId:function(){return this.id||(this.id=v++)},stop:function(){var e=this.contextualized||this.variable;e.stopNotifies(this)}},r.prototype=Object.create(n.prototype),r.prototype.shouldRender=function(e){return document.body.contains(e)},r.prototype.getSubject=function(){return this.element},r.prototype.updateRendering=function(e,t){if(!t&&this.elements){var n=this.elements;if(!n.length){if(!this.selector)throw new Error("No element or selector was provided to the Renderer");return void(n=document.querySelectorAll(this.selector))}for(var r=0,i=n.length;r<i;r++)this.updateRendering(e,n[r])}else{var o=t||this.element;if(e||this.shouldRender(o))this.updateElement(o);else{var a=this.getId(),s=o.renderersOnShow;s||(s=o.renderersOnShow=[],o.className+=" needs-rerendering"),s[a]||(s[a]=this)}}},r.prototype.addElement=function(e){this.selector?e.renderersOnShow=[this]:this.elements.push(e),this.updateElement(e)},r.prototype.updateElement=function(e){if(this.invalidated=!1,!this.omitValueOf){var t=this.variable.valueOf(this),n=this.contextualized||this.variable;n.notifies(this)}if(void 0!==t||this.started||this.omitValueOf)if(this.started=!0,t&&t.then){this.renderLoading&&this.renderLoading(t,e);var r=this,i=this.deferredRender=function(t){i.isCanceled||(i===r.deferredRender&&(r.deferredRender=null),r.renderUpdate(t,e))};t.then(i)}else this.renderUpdate(t,e)},r.prototype.renderUpdate=function(e,t){throw new Error("renderUpdate(newValue) must be implemented")},n.Renderer=n,n.ElementRenderer=r,i.prototype=Object.create(r.prototype),i.prototype.type="AttributeRenderer",i.prototype.renderUpdate=function(e,t){t.setAttribute(this.name,e);
},n.AttributeRenderer=i,o.prototype=Object.create(r.prototype),o.prototype.type="PropertyRenderer",o.prototype.renderUpdate=function(e,t){t[this.name]=e},n.PropertyRenderer=o,a.prototype=Object.create(o.prototype),a.prototype.type="InputPropertyRenderer",a.prototype.renderUpdate=function(e,t){(null==e||"number"===t.type&&isNaN(e))&&(e="");var n=t[this.name];"string"==typeof n&&"string"!=typeof e&&(e=null==e?"":String(e)),n!=e&&(t[this.name]=e)},a.prototype.renderSelectValueUpdate=function(t,n){n.value=t,n.value==t||n.value?n.eventualValue=void 0:(n.eventualValue=t,e.nextTurn(function(){n.eventualValue&&(n.value=n.eventualValue,n.eventualValue=void 0)}))},n.InputPropertyRenderer=a,s.prototype=Object.create(r.prototype),s.prototype.type="StyleRenderer",s.prototype.renderUpdate=function(e,t){t.style[this.name]=e},n.StyleRenderer=s,u.prototype=Object.create(r.prototype),u.prototype.type="ContentRenderer",u.prototype.renderUpdate=function(e,t){t.innerHTML="",void 0===e&&(e=""),t.appendChild(document.createTextNode(e))},n.ContentRenderer=u,c.prototype=Object.create(r.prototype),c.prototype.type="TextRenderer",c.prototype.updated=function(e,t){this.builtList&&("refresh"===e.type?(this.builtList=!1,this.omitValueOf=!1):(this.updates||(this.updates=[])).push(e)),r.prototype.updated.call(this,e,t)},c.prototype.renderUpdate=function(e,t){null==e&&(e=""),e.create&&(e=e.create({parent:t})),e.nodeType?(this.textNode&&this.textNode.parentNode==t?t.replaceChild(e,this.textNode):t.appendChild(e),this.textNode=e):e instanceof Array?(this.renderUpdate=l.prototype.renderUpdate,this.omitValueOf=!0,this.renderUpdate(e,t)):(this.textNode||t.childNodes[this.position]).nodeValue=e},n.TextRenderer=c,l.prototype=Object.create(r.prototype),l.prototype.updated=function(e,t){this.builtList&&("refresh"===e.type?(this.builtList=!1,this.omitValueOf=!1):(this.updates||(this.updates=[])).push(e)),r.prototype.updated.call(this,e,t)},l.prototype.type="ListRenderer",l.prototype.renderUpdate=function(e,t){function r(e){var t;return o.create?t=o.create({parent:a,_item:e}):(t=o(e,a),t.create&&(t=t.create({parent:a,_item:e}))),t}var i,o=this.each||function(e){return e},a=this.element,s=this;if(this.builtList){var u=this.childElements,c=this.updates;i=a,c.forEach(function(e){if("refresh"===e.type){s.builtList=!1;for(var t=0,i=u.length;t<i;t++)a.removeChild(u[t]);s.renderUpdate()}else if(e.previousIndex>-1&&(a.removeChild(u[e.previousIndex]),u.splice(e.previousIndex,1)),e.index>-1){var o=u[e.index],c=n.append(a,r(e.value));o?(a.insertBefore(c,o),u.splice(e.index,0,c)):u.push(c)}}),this.updates=[]}else{this.builtList=!0,this.omitValueOf=!0,t.innerHTML="";var u=this.childElements=[];o.defineHasOwn&&o.defineHasOwn(),e&&e.forEach(function(e){u.push(n.append(a,r(e)))});var l=this.contextualized||this.variable;l.notifies(this)}},n.ListRenderer=l,n.onShowElement=function(e){y(function(){p=null;var t=[].slice.call(e.getElementsByClassName("needs-rerendering"));if(e.className.indexOf("needs-rerendering")>0){var n=[e];n.push.apply(n,t),t=n}for(var r=0,i=t.length;r<i;r++){var o=t[r],a=o.renderersOnShow;if(a){o.renderersOnShow=null,o.className=o.className.replace(/\s?needs\-rerendering\s?/g,"");for(var s in a){var u=a[s];u.updateElement(o)}}}})},n.onElementRemoval=function(e,t){t||f(e);for(var n=e.getElementsByTagName("*"),r=0,i=n.length;r<i;r++){var o=n[r];o.alkaliRenderers&&f(o)}},n})},function(e,t,n){var r,i,o;!function(a,s){i=[n(2)],r=s,o="function"==typeof r?r.apply(t,i):r,!(void 0!==o&&(e.exports=o))}(this,function(e){function t(e,t){return e&&e.then?e.then(t):t(e)}function n(e,t){return e&&e.then&&!e.notifies?e.then(t):t(e)}function r(e){this.subject=e,this.sources=[]}function i(e,t){this.subject=t,this.listener=e}function o(t,n){for(var r,i=0,o=t.length;i<o;i++)t[i]&&t[i].then&&(r=!0);return r?e.whenAll(t,n):n(t)}function a(e,t){var n=K.get(e),r=t.listenerId||(t.listenerId="-"+Y++);n?n[r]===I&&(n[r]=n.push(t)-1):(K.set(e,n=[t]),n[r]=0,h.autoObserveObjects&&observe(e)),t.listeningToObject=e}function s(e){if(e.listeningToObject){var t=e.listeningToObject;e.listeningToObject=null;var n=K.get(t);if(n){var r=n[e.listenerId];r>-1&&(n.splice(r,1),delete n[e.listenerId])}}}function u(){this.visited=new Set}function c(e,t,n){this.key=e,this.childEvent=t,this.parent=n,this.visited=t.visited}function l(e){this.visited=new Set;for(var t in e)this[t]=e[t]}function f(e){this.visited=new Set;for(var t in e)this[t]=e[t]}function p(e,t,n){e===t&&p(e,e._properties,n);for(var r in t){var i=t[r];if(i&&i.parent==e&&(i.returnedVariable&&n(i.returnedVariable),i.hasChildNotifiers)){var o=i._properties;o&&p(i,i,n)}}}function h(e){return this instanceof h?void(e===I?this["default"]!==I&&(this.value=this["default"]):this.value=e):h["with"](e)}function d(e,n){return t(e.cachedValue||e.valueOf(),function(t){t||e.put(t=[]);var r=n.call(e,t);return e.cachedVersion++,r})}function v(e,t,n,r){var i=t.length;if(i>0){for(var o,a=r-i;a>n;){var o=e[--a];o&&(e[a]=I,o.key+=i,e[o.key]=o)}for(var a=0,s=t.length;a<s;a++)e.updated(new l({value:t[a],index:a+n,modifier:e}),e)}}function y(e,t,n,r,i){var o,a=n+r;if(r>0){for(var a=n+r;a<i+r;a++){var o=e[a];o&&(e[a]=I,o.key-=r,e[o.key]=o)}for(var a=0;a<r;a++)e.updated(new f({previousIndex:n,oldValue:t[a],modifier:e}),e);e.cachedVersion=e.version}}function m(e){if(!e)return[];if(e.length>-1)return e;var t=[];return e.forEach&&e.forEach(function(e){t.push(e)}),t}function g(e,t,n){return e instanceof h?void h.call(e,t):n["with"](t)}function b(e){var t=K.get(e);if(t)for(var n=0,r=t.length;n<r;n++)t[n]._propertyChange(null,e)}function w(e,t){if(e instanceof Array)return e.length>1e3,e.length>0||"function"==typeof t?new Q(e[0],"function"==typeof t?t:ie,e):new te([]);if(arguments.length>1)return new Q(arguments[0],ie,arguments).as(te);if("object"==typeof e){var n=[],r=[];for(var i in e)n.push(i),r.push(e[i]);return new h(function(e){for(var t={},r=0;r<e.length;r++)t[n[r]]=e[r];return t}).apply(null,r)}throw new TypeError("Variable.all requires an array")}function O(e,t){var n=this.ownedClasses||(this.ownedClasses=new F);return n.set(e,t||function(){return new e}),this}function _(){for(var e=this.prototype,t=Object.getOwnPropertyNames(e),n=0,r=t.length;n<r;n++){var i=t[n];Object.defineProperty(this,i,x(Object.getOwnPropertyDescriptor(e,i),i,this))}}function x(e,t,n){return"function"==typeof e.value?{value:j(n,t)}:e}function j(e,t){var n=e[t]=function(){var n=e["for"](this);return n[t].apply(n,arguments)};return n["for"]=function(n){var r=e["for"](n);return function(){return r[t].apply(r,arguments)}},n}function C(e,t){return t?t.specify(e):e.defaultInstance}function E(){}function S(){}function V(e){return g(this,"object"==typeof e?e:String(e),V)}function P(e){return g(this,"object"==typeof e?e:Number(e),P)}function T(e){return g(this,"object"==typeof e?e:Boolean(e),T)}function k(e){return g(this,e instanceof Array?new Set(e):e,k)}function N(e){return g(this,"object"==typeof e?e:new Date(e),N)}function M(e){if("string"==typeof e)return ue[e];if("object"==typeof e){if(e instanceof Array)return te.of(M(e[0]));var t={};for(var n in e)t[n]=M(e[n]);return h["with"](t)}return e}function A(e,t){var n=Reflect.getMetadata("design:type",e,t);console.log("Type",n),n.notifies||(n=le.get(n)||h),Object.defineProperty(e,t,{get:function(){return A.get(this,t,n)},set:function(e){A.set(this,t,e)},enumerable:!0})}function R(t,n,r,i){var o=e.compose(i?i.as(fe):fe,n,r);o.prototype.method||(o.prototype.method=t),Object.defineProperty(o.prototype,"isIterable",{value:!0}),te[t]=te.prototype[t]=function(){var e=new o(this);return e.source=this,e.arguments=arguments,e}}var I,D={},L={},F=e.WeakMap,B=Object.setPrototypeOf||function(e,t){e.__proto__=t},W=Object.getPrototypeOf||function(e){return e.__proto__},U=e.isGenerator,H=3,z=4,q={},K=new F(null,"propertyListenersMap"),G=(new F,Date.now()),Y=(e.compose(F,function(){},{_propertyChange:function(e){this.variable._propertyChange(e,contextFromCache(this))}}),1);r.prototype={constructor:r,newContext:function(e){return new r(this.subject)},version:0,restart:function(){},contextualize:function(e,t){var n;if(this.distinctSubject){var r=e._contextMap||(e._contextMap=new F);if(n=r.get(this.distinctSubject),!n){r.set(this.distinctSubject,n=Object.create(e)),n.listeners=!1,n.context=this;for(var i=this.sources,o=0,a=i.length;o<a;o++)n[i[o]]=i[++o]}this.contextualized=n,t&&t.merge(this)}else n=e;return n},integrate:function(e,t){this.addInput(t),this.hash(e.version),this.hash(Math.max(t.version||0,t.versionWithChildren||0))},hash:function(e){if(isNaN(e))throw new Error("Bad version");return this.version=Math.max(this.version,e)},merge:function(e){this.distinctSubject||(this.distinctSubject=e.distinctSubject)},specify:function(e){var t,n=this.subject,r=n.constructor.ownedClasses;if(r){this.distinctSubject||(this.distinctSubject=n);var i=r.get(e);if(i)return t=i.get(n),t||i.set(n,t=i.createInstance?i.createInstance(n):new e),t}return e.defaultInstance},getContextualized:function(e){if(!this.subject)return e;var t=e._contextMap&&this.subject&&e._contextMap.get(this.subject);return t&&t.context&&t.context.matches(this)?t:void 0},addInput:function(e){this.sources.push(this.nextProperty,e)},matches:function(e){return e.subject===this.subject}},i.prototype=Object.create(r.prototype),i.prototype.constructor=i,i.prototype.addInput=function(e){e.notifies(this.listener)},u.prototype.type="refresh",c.prototype.type="update",l.prototype.type="add",f.prototype.type="delete",h._logStackTrace=function(e){var t=((new Error).stack||"").split(/[\r\n]+/);t[0]&&/^Error\s*/.test(t[0])&&t.shift(),t[0]&&/_logStackTrace/.test(t[0])&&t.shift();var n=this._debugOpts&&this._debugOpts.coalesce||[];if(this._debugOpts&&this._debugOpts.shortStackTrace){var r;t.some(function(e){n.some(function(t){return t.re.test(e)})||(e=t[0])}),console.log("Variable "+e.__debug+" changed",r&&r.replace(/^\s+/,""))}else{if(n.length){for(var i,o=[],a=0;a<t.length;a++){var r=t[a];if(i){if(i.test(r))continue;i=null}n.some(function(e){return e=e.re.test(r)}),r=r.replace(/^\s+/,""),i?(o.push("("+i.name+") "+r),i=i.re):o.push(r)}t=o}var s=this._debugOpts&&this._debugOpts.stackObject;s?console.log("Variable "+e.__debug+" changed",t):console.log("Variable "+e.__debug+" changed\r\n"+t.join("\r\n"))}},h._debugOpts={coalesce:[{name:"alkali",re:/\/alkali\//},{name:"Promise",re:/(Promise\.)|(PromiseArray\.)|(\/bluebird\/)/}],stackObject:!1};var J=h.prototype={get _currentValue(){return this.valueOf()},set _currentValue(e){this.put(e)},constructor:h,valueOf:function(e){var t;return this.gotValue(this.getValue?this.getValue(e,e&&(t=e.newContext())):this.value,e,t)},getValue:function(e,n){if(e&&e.hash(this.version),this.parent){e&&(n||(n=e.newContext()),null!=e.ifModifiedSince&&(e.ifModifiedSince=I));var r,i=this.key,o=this.parent;if(r=o.getValue?o.getValue(e,n):o.value,r&&r.then&&!r.notifies)return t(r,function(t){var r=null==t?I:"function"==typeof t.property?t.property(i):"function"==typeof t.get?t.get(i):t[i],o=K.get(t);return o&&o.observer&&o.observer.addKey&&o.observer.addKey(i),n&&e.hash(n.version),r});var a=null==r?I:"function"==typeof r.property?r.property(i):"function"==typeof r.get?r.get(i):r[i],s=K.get(r);return s&&s.observer&&s.observer.addKey&&s.observer.addKey(i),n&&e.hash(n.version),a}return this.value},gotValue:function(e,t,n){var r=this.returnedVariable,i=this;if(r){if(e===r)return t?(n||(n=t.newContext()),n.nextProperty="returnedVariable",e=e.valueOf(n),t.integrate(n,n.contextualize(this,t)||this),e):e.valueOf();i.listeners&&r.stopNotifies(i),i.returnedVariable=null}return e&&e.notifies&&(i.returnedVariable=e,i.listeners&&e.notifies(i),n=n||t&&(n=t.newContext()),n&&(n.nextProperty="returnedVariable"),e=e.valueOf(n)),e===I&&(e=i["default"]),e&&e.then?e.then(function(e){return e&&e.subscribe?h.prototype.gotValue.call(i,e,t,n):(n?t.integrate(n,n.contextualize(i,t)||i):t&&t.addInput(i),e)}):(n&&t.integrate(n,n.contextualize(this,t)||this),t&&(n||t.addInput(this)),e)},PropertyClass:h,property:function(e,t){var n=this[e];if(n&&n.notifies||(n=this._properties&&this._properties[e]),n){if(t&&!(n instanceof t))throw new TypeError("Existing property variable does not match requested variable type")}else{var r=t;r||(r=this.constructor[e],"function"==typeof r&&r.isPropertyClass||(r=this.PropertyClass)),n=new r,n.key=e,n.parent=this,this[e]===I?this[e]=n:(this._properties||(this._properties={}))[e]=n}return n},"for":function(e){return e&&e.target&&!e.constructor.getForClass&&(e=e.target),this.parent?this.parent["for"](e).property(this.key):new ee(this,e||oe)},_changeValue:function(e,t,r){var i=this.key,o=this.parent;if(!o)return this.put(r,e);var a=this;return n(o.getValue?o.getValue(e):o.value,function(n){if(null==n)o.put(n="number"==typeof i?[]:{},e);else if("object"!=typeof n){var s=new Error("Can not set property on non-object");throw s.deniedPut=!0,s}var c="function"==typeof n.get?n.get(i):n[i];if(c===r&&"object"!=typeof r)return L;"function"==typeof n.set?n.set(i,r):t==H&&c&&c.put&&!r&&r.put?c.put(r):n[i]=r;var l=new u;l.oldValue=c,l.target=a,a.updated(l,a,e);var f=K.get(n);if(f){f=f.slice(0);for(var p=0,h=f.length;p<h;p++){var d=f[p];d!==o&&d._propertyChange(i,n,e,t)}}return r})},_propertyChange:function(e,t,n,r){this.onPropertyChange&&this.onPropertyChange(e,t,n),this.updated(new c(e,new u,this),null,n)},eachKey:function(e){for(var t in this._properties)e(t);for(var t in this)if(this.hasOwnProperty[t]){var n=this[t];n&&n.parent==this&&n.listeners&&e(t)}},apply:function(e,t){return new Q(t[0],this,t)},call:function(e){return this.apply(e,Array.prototype.slice.call(arguments,1))},forDependencies:function(e){this.returnedVariable&&e(this.returnedVariable),this.hasNotifyingChild&&p(this,this,e),this.parent&&e(this.parent)},init:function(){var e=this;this.forDependencies(function(t){t.notifies(e)}),null===this.listeningToObject&&this.valueOf()},cleanup:function(){this.listeners=!1;var e=this.handles;if(e)for(var t=0;t<e.length;t++)e[t].remove();this.handles=null;var n=(this.returnedVariable,this);this.forDependencies(function(e){e.stopNotifies(n)})},version:0,versionWithChildren:0,updateVersion:function(e){this.version=G=Math.max(Date.now(),G+1)},getVersion:function(e){return Math.max(this.version,this.returnedVariable&&this.returnedVariable.getVersion?this.returnedVariable.getFullVersion(e):0,this.parent?this.parent.getVersion(e):0)},getFullVersion:function(e){return Math.max(this.versionWithChildren,this.getVersion(e))},getSubject:function(e){return this.subject},getUpdates:function(e){var t=[],n=this.nextUpdateMap;if(n&&e)for(;e=n.get(e);)"refresh"===e.type&&(t=[]),t.push(e);return t},updated:function(e,t,n,r){if(e||(e=new u,e.source=this),e.visited.has(this))return e;e.visited.add(this),this.__debug&&h._logStackTrace(this);var i=n&&n.getContextualized(this);i&&i.updated(e,this,n),e instanceof c?this.versionWithChildren=Math.max(Date.now(),G+1):r||this.updateVersion();var o=this.listeners;if(o){var a=this;o=o.slice();for(var s=0,l=o.length;s<l;s++){var f=o[s];e instanceof c&&f.parent?f.key===e.key&&f.updated(e.childEvent,a,n,!0):f.updated(e,a,n,!0)}}return e instanceof c&&(this.returnedVariable&&this.fixed&&this.returnedVariable.updated(e,this,n),this.constructor.collection&&this.constructor.collection.updated(e,this,n)),this.parent&&this.parent.updated(new c(this.key,e,this.parent),this,n),this.collection&&this.collection.updated(e,this,n),e},invalidate:function(){this.updated()},notifies:function(e){if(!e)throw new Error("No listener provided for notification");var t=this.listeners;t&&this.hasOwnProperty("listeners")?t.indexOf(e)===-1&&t.push(e):(this.listeners=t=[e],this.init())},subscribe:function(t){var n,r,i=this;if("function"==typeof t){var i=this,o={value:function(){return i.valueOf()}};n=function(){r=!1,t(o)}}else{if(!t.next)throw new Error("Subscribing to an invalid listener, the listener must be a function, or have an update or next method");n=function(){r=!1,t.next(i.valueOf())}}var a={updated:function(){r||(r=!0,e.nextTurn(n))}};return n(),this.notifies(a),{unsubscribe:function(){i.stopNotifies(a)}}},stopNotifies:function(e){var t=this.listeners;if(t){var n=t.indexOf(e);n>-1&&(t.splice(n,1),0===t.length&&this.cleanup())}},put:function(e,t){var r=this;return this.parent?this._changeValue(t,H,e):n(this.getValue?this.getValue(t):this.value,function(i){if(i===e&&"object"!=typeof e)return L;if(i&&i.put&&(r.fixed||!e||!e.put))try{return i.put(e)}catch(o){if(!o.deniedPut)throw o}return n(r.setValue(e,t),function(e){var n=new u;return n.oldValue=i,n.target=r,r.updated(n,r,t),e})})},get:function(e){if(this[e]||this._properties&&this._properties[e])return this.property(e).valueOf();var t=this.getValue();if(t)return"function"==typeof t.get?t.get(e):n(t,function(t){var n=t[e];return n&&n.notifies?n.valueOf():n})},set:function(e,t){this.property(e)._changeValue(null,z,t)},undefine:function(e,t){this.set(e,I,t)},is:function(e){var t=this;return this.fixed=!0,n(this.setValue(e),function(e){return t.updated(new u,t),t})},proxy:function(e){return this.is(e)},next:function(e){this.put(e)},error:function(e){var t=this.listeners;t&&t.forEach(function(t){t.error(e)})},complete:function(e){this.put(e)},setValue:function(e){this.value=e},onValue:function(e){return this.subscribe(function(n){t(n.value(),function(t){e(t)})})},toJSON:function(){return this.valueOf()},toString:function(){return String(this.valueOf())},forEach:function(e,n,r){if(e.notifies)return this.forEach(function(t){var r=e.from(t);n.call(this,r)},r);var i=this.collectionOf;if(i){var o=this;return t(this.valueOf(n),function(t){t&&t.forEach&&t.forEach(function(t,n){e.call(o,o.property(n,i))})})}return t(this.valueOf(n),function(t){if(t&&t.forEach)t.forEach(e);else for(var n in t)e.call(t,t[n],n)})},to:function(e,t){if("function"!=typeof e)throw"object"==typeof e&&this.to(e.get,e.set),new Error("No function provided to transform");return t&&(e.reverse=function(e,n,r){t.call(this,e,n[0],r)}),e.prototype instanceof h?new e(this):new Q(this,e)},map:function(e){return this.to(function(t){if(t instanceof Array)throw new Error("map without VArray");return e(t)})},as:function(e){return new e(this)},get schema(){if(this.returnedVariable)return this.returnedVariable.schema;if(this.parent){var e=this.parent.schema.properties||this.parent.schema;return e&&e[this.key]}return this.constructor},set schema(e){Object.defineProperty(this,"schema",{value:e})},validate:function(e,t){if(this.returnedVariable)return this.returnedVariable.validate(e,t);if(this.parent)return this.parent.validate(e.valueOf(),t);if(t){if(t.type&&t.type!==typeof e)return["Target type of "+typeof e+" does not match schema type of "+t.type];if(t.required&&(null==e||""==e||"number"==typeof e&&isNaN(e)))return["Value is required"]}var n=[];return n.isValid=!0,n},get validation(){var e=new re(this);return Object.defineProperty(this,"validation",{value:e}),e},set validation(e){Object.defineProperty(this,"validation",{value:e})},set structured(e){for(var t=Object.keys(this),n=t.length>1&&this._properties||(this._properties={}),r=0,i=t.length;r<i;r++){var o=t[r],a=this[o];if(a instanceof h){var s=n[o];if(s)s!==a&&s.put(a);else{if(a.parent){if(a.parent===this)continue;var u=new h;u.proxy(a),a=u}a.key=o,a.parent=this,n[o]=a}}}},getId:function(){return this.id||(this.id=h.nextId++)},observeObject:function(){var n=this;return t(this.valueOf(),function(t){var r=K.get(t);if(r||K.set(t,r=[]),r.observerCount)r.observerCount++;else{r.observerCount=1;var i=r.observer=e.observe(t,function(e){for(var n=0,i=r.length;n<i;n++)for(var o=r[n],a=0,s=e.length;a<s;a++){var u=e[a];o._propertyChange(u.name,t)}});if(i.addKey)for(var o=0,u=r.length;o<u;o++){var c=r[o];c.eachKey(function(e){i.addKey(e)})}}return a(t,n),{remove:function(){s(t,n),--r.observerCount||r.observer.remove()},done:function(){e.deliverChanges(i),this.remove()}}})},getCollectionOf:function(){return this.returnedVariable&&this.returnedVariable.collectionOf||this.constructor.collectionOf},_sN:function(e){return this.name=e,this},get _debug(){return this.__debug===I&&(this.__debug=this.name||(Math.random()+"").slice(2)),this.__debug},set _debug(e){this.__debug=e},get _lastUpdated(){return new Date(this.getVersion())}};for(var Z in J)Object.defineProperty(h,Z,Object.getOwnPropertyDescriptor(J,Z));h.as=function(e){var t=this["with"]({}),n=t.prototype,r=e.prototype;do{for(var i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o];Object.getOwnPropertyDescriptor(n,a)||Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(r,a))}r=W(r)}while(r&&r!==h.prototype);return t},h["with"]=function(t,n){var r,i=this;return Object.getOwnPropertyDescriptor(this,"prototype").writable===!1?(n=e.extendClass(this),r=n.prototype):(n=n||function(){return this instanceof n?void i.apply(this,arguments):n["with"](t)},r=n.prototype=Object.create(this.prototype),r.constructor=n,B(n,this)),n.assign(t)},h.assign=function(e){var t=this.prototype;for(var n in e){var r=Object.getOwnPropertyDescriptor(e,n),i=r.value;"function"==typeof i&&"collectionOf"!==n&&(i.notifies?(r=function(e,t){return{get:function(){var n=(this._properties||(this._properties={}))[e];return n||(this._properties[e]=n=new t,n.key=e,n.parent=this,n.listeners&&n.init()),n},set:function(t){this[e]._changeValue(null,z,t)},enumerable:!0}}(n,i),i===h&&(i=h()),i.isPropertyClass=!0):U(i)?r=pe(i):i.defineAs?r=i.defineAs(n):i=j(i,n)),Object.defineProperty(t,n,r),i!==I?this[n]=i:Object.defineProperty(this,n,r)}return e&&e.hasOwn&&O.call(this,e.hasOwn),this},Object.defineProperty(h,"defaultInstance",{get:function(){return this.hasOwnProperty("_defaultInstance")?this._defaultInstance:(this._defaultInstance=new this,this._defaultInstance.subject=oe,this._defaultInstance)}}),h.hasOwn=function(e,t){var n=new F;n.createInstance=t;var r=this.ownedClasses||(this.ownedClasses=new F);r.set(e,n)},"undefined"!=typeof Symbol&&(h.prototype[Symbol.iterator]=function(){var e=this.valueOf()[Symbol.iterator](),t=this,n=this.collectionOf;if(n){var r=0;return{next:function(){var i=e.next();return i.done||(i.value=t.property(r++,n)),i}}}return e});var X=h.VMap=e.compose(h,function(e){this.value="undefined"==typeof e?this["default"]:e},{fixed:!0,property:function(e,t){var n=this._properties||(this._properties=new Map),r=n.get(e);return r||(r=new(t||this.PropertyClass),r.key=e,r.parent=this,r.listeners&&r.init(),n.set(e,r)),r}}),Q=h.Transform=e.compose(h,function(e,t,n){if((e!==I||n)&&(this.source=e),t&&(this.transform=t,n))for(var r=1,i=n.length;r<i;r++)this["source"+r]=n[r]},{getValue:function(e,t){var n=e?e.getContextualized(this):this,i=null;if(n){if("invalidated"==n.readyState)i=n.readyState=G.toString();else if(isFinite(n.readyState));else if(n.listeners&&n.cachedVersion>-1)return t&&(t.version=n.cachedVersion,t.contextualize(n,e)),n.cachedValue;!this.hasOwnProperty("source1")&&e,i=n.readyState}t||(t=e?e.newContext():new r),t.nextProperty="transform";var a=this.transform&&this.transform.valueOf(t),s=[];this.version&&t.hash(this.version),n&&this.cachedVersion>=t.version&&n.cachedVersion>-1&&!this.hasOwnProperty("source1")&&(t.ifModifiedSince=n.cachedVersion);for(var u,c,l=0;(u=this[c=l>0?"source"+l:"source"])||c in this;l++)t&&(t.nextProperty=c),s[l]=u&&u.valueOf(t);var f=this;return o(s,function(n){t.ifModifiedSince!==I&&(t.ifModifiedSince=I);var r=t.contextualize(f,e),o=t.version;if(r&&r.cachedVersion===o)return r.readyState="up-to-date",e&&e.ifModifiedSince>=o&&!r.returnedVariable?q:r.cachedValue;if(n[0]==q)throw new Error("A not-modified signal was passed to a transform, which usually means a version number was decreased (they must monotically increase), computed version"+o+" this variable version: "+r.version+" cached version: "+r.cachedVersion+" ifModifiedSince: "+t.ifModifiedSince+" source version: "+r.source.version+" source cached version: "+r.source.cachedVersion);var s=a?a.apply(f,n):n[0];return i!=r.readyState&&null!==i||(r.readyState&&(r.readyState="up-to-date"),r.cachedVersion=t.version,r.cachedValue=s,s&&s.then&&s.then(function(){r.cachedVersion=t.version},function(){r.cachedValue=null,r.cachedVersion=0})),s})},forDependencies:function(e){h.prototype.forDependencies.call(this,e);for(var t,n,r=0;(t=this[n=r>0?"source"+r:"source"])||n in this;r++)t&&t.notifies&&e(t)},updated:function(e,t,n,r){if(this.readyState="invalidated",t!==this.returnedVariable&&e&&"refresh"!==e.type)for(var i,o,a=0;(i=this[o=a>0?"source"+a:"source"])||o in this;a++)i!==t||(e=new u);return h.prototype.updated.call(this,e,t,n,r)},getUpdates:function(e){if(!e||e.version<getVersion())return[new u]},getArguments:function(){for(var e,t,n=[],r=0;(e=this[t=r>0?"source"+r:"source"])||t in this;r++)n.push(e);return n},put:function(e,n){var r=this;return t(this.valueOf(n),function(t){if(t===e&&"object"!=typeof e)return L;var i=r.transform.valueOf(n);if(!i.reverse){if(t&&t.put)return t.put(e);var o=new Error("Can not put value into a one-way transform, that lacks a reversal");throw o.deniedPut=!0,o}i.reverse.call(r,e,r.getArguments(),n),r.updated(null,null,n)})},setReverse:function(e){return this.transform.valueOf().reverse=e,this}}),$=e.compose(h,function(e,t){this.value=e,this.collection=t},{}),ee=e.compose(h,function(e,t){this.generic=e,this.subject=t},{valueOf:function(){var e=this.subject;return this.generic.valueOf(e.getContextualized?e:new r(e))},forDependencies:function(e){this.sources&&this.sources.forEach(e)},getVersion:function(){for(var e=h.prototype.getVersion.call(this),t=this.sources||0,n=0,r=t.length;n<r;n++){var i=t[n];i.getFullVersion&&(e=Math.max(e,i.getFullVersion()))}return e},put:function(e){var t=this.subject;return this.generic.put(e,t.getContextualized?t:new r(t))}}),te=h.VArray=e.compose(h,function he(e){return g(this,e,he)},{_isStrictArray:!0,property:function(e,t){return h.prototype.property.call(this,e,t||"number"==typeof e&&this.collectionOf)},splice:function(e,t){var n=arguments;return d(this,function(r){e<0&&(e=r.length+e);var i=r.splice.apply(r,n);return y(this,i,e,t,r.length),v(this,[].slice.call(n,2),e,r.length),i})},push:function(){var e=arguments;return d(this,function(t){var n=t.push.apply(t,e);return v(this,e,t.length-e.length,t.length),n})},unshift:function(){var e=arguments;return d(this,function(t){var n=t.unshift.apply(t,e);return v(this,e,0,t.length),n})},pop:function(){return d(this,function(e){var t=e.pop();return y(this,[t],e.length,1),t})},shift:function(){return d(this,function(e){var t=e.shift();return y(this,[t],0,1,e.length),t})}});te.of=function(e){var t=te({collectionOf:e});return this!==te?new t:t};var ne=e.compose(Q,function(e){this.generator=e},{transform:{valueOf:function(e){function t(){var r,i,o,a;for(n?(o=n.iterator,i=n.i,r=n.value,a=n.isThrowing):(e&&e.restart(),i=0,o=this.generator());;){var s=o[a?"throw":"next"](r);if(s.done){for(var u=this.sources||[],c=i,l=[];this[f=i>0?"source"+i:"source"];)this[f]=I,i++;for(i=0;i<c;i++){var f=i>0?"source"+i:"source";this[f]&&this[f].notifies&&l.push(this[f])}for(i=0;i<u.length;i++)l.indexOf(u[i])==-1&&u[i].stopNotifies(this);return this.sources=l,s.value}var p=s.value;try{var f=i>0?"source"+i:"source";if(this[f]===p&&this[f]!==I||(p&&p.notifies?(this.listeners&&p.notifies(this),this[f]=p):"function"==typeof p&&U(p)?(n={i:i,iterator:p()},t.call(this),i=n.i):this[f]=null),i++,e&&(e.nextProperty=f),r=p&&p.valueOf(e),r&&r.then){var h=this;return n={i:i,iterator:o},r.then(function(e){return n.value=e,t.call(h)},function(e){return n.value=e,n.isThrowing=!0,t.call(h)})}a=!1}catch(d){a=!0,r=d}}}var n;return t}}}),re=e.compose(Q,function(e){this.source=e},{transform:function(e){var e=this.source;return e.validate(e,e.schema)}}),ie={apply:function(e,t){return t}},oe={name:"Default context",description:"This object is the default context for classes, corresponding to a singleton instance of that class",constructor:{getForClass:function(e,t){return t.defaultInstance}},contains:function(){return!0}};h.valueOf=function(e){return C(this,e).valueOf(e)},h.getValue=function(e){return C(this,e)},h.put=function(e,t){return C(this,t).put(e,t)},h["for"]=function(e){if(null!=e){e.target&&!e.constructor.getForClass&&(e=e.target);var t;return t=new r(e).specify(this),t&&!t.subject&&(t.subject=e),t||this.defaultInstance}return this.defaultInstance},h.from=function(e){if(e&&"object"==typeof e){var t=this.instanceMap||(this.instanceMap=new F),n=t.get(e);return n||t.set(e,n=new this(e)),n}return new this(e)},h.notifies=function(e){this.defaultInstance.notifies(e)},h.stopNotifies=function(e){this.defaultInstance.stopNotifies(e)},h.getCollectionOf=function(){return this.collectionOf},h.updated=function(e,t,n){return C(this,n).updated(e,t,n)};var ae={get:function(e,t){var n=e[t];return n===I?e.property(t):n},set:function(e,t,n){var r=e[t];return r&&r.put?r.put(n):e.set(t,n),!0},has:function(e,t){return t in e||t in e.valueOf()},deleteProperty:function(e,t){return ae.set(e,t,I)},ownKeys:function(e){return Object.getOwnPropertyNames(e.valueOf())}};h.proxy=function(e){return new Proxy(e instanceof this?e:this.from(e),ae)},Object.defineProperty(h,"collectionOf",{get:function(){return this._collectionOf},set:function(e){this._collectionOf!=e&&(this._collectionOf=e,e.collection=this)}}),Object.defineProperty(h,"collection",{get:function(){return this._collection},set:function(e){this._collection!=e&&(this._collection=e,e.collectionOf=this)}}),h.nextVersion=Date.now(),h.generalize=_,h.call=Function.prototype.call,h.apply=Function.prototype.apply,E.returns=function(e){function t(){}return t.defineAs=function(t){return{value:function(){var n=arguments;return new e(new Q(this,function(e){return null==e?I:e[t].apply(e,n)}))}}},t},S.defineAs=function(e){return{value:function(){var n=arguments,r=this;return t(this.valueOf(),function(i){var o=i[e].apply(i,n);return t(r.put(i),function(){return o})})}}},V=h["with"]({charAt:E.returns(V),codeCharAt:E.returns(P),indexOf:E.returns(P),lastIndexOf:E.returns(P),match:E.returns(te),replace:E.returns(V),substr:E.returns(V),slice:E.returns(V),toUpperCase:E.returns(V),toLowerCase:E.returns(V),length:P},V),P=h["with"]({toFixed:E.returns(V),toExponential:E.returns(V),toPrecision:E.returns(V),toLocaleString:E.returns(V)},P),T=h["with"]({},T),k=h["with"]({has:E.returns(T),add:S,clear:S,"delete":S},k),Object.defineProperty(k.prototype,"array",{get:function(){return this._array||(this._array=this.to(m).as(te))}}),N=h["with"]({toDateString:E.returns(V),toTimeString:E.returns(V),toGMTString:E.returns(V),toUTCString:E.returns(V),getTime:E.returns(P),setTime:S},N);var se=e.compose(h,function de(e){return g(this,e,de)},{then:function(e,t){var n=this.valueOf();return n&&n.then?n.then(e,t):e(n)}}),ue={string:V,number:P,"boolean":T},ce={__esModule:!0,Variable:h,VArray:te,"default":h,VString:V,VNumber:P,VBoolean:T,VPromise:se,VDate:N,VSet:k,VMap:X,Transform:Q,deny:D,noChange:L,Context:r,GeneratorVariable:ne,Item:$,NotifyingContext:i,Context:r,all:w,objectUpdated:b,reactive:A,NOT_MODIFIED:q},le=new Map;le.set(Array,te),le.set(String,V),le.set(Number,P),le.set(Boolean,T),A.get=function(e,t,n){var r=(e._properties||(e._properties={}))[t];return r||(e._properties[t]=r=new(M(n)),e.getValue&&(r.key=t,r.parent=e,r.listeners&&r.init())),r},A.set=function(e,t,n){var r=e[t];r.parent?r._changeValue(null,z,n):r.put(n)};var fe=e.compose(Q,function(e,t,n){this.source=e,this.method=t,this.arguments=n},{transform:function(e){var t=this.method,n=this.source&&this.source._isStrictArray;return e&&e.forEach||(e=n?[]:[e]),"string"==typeof t?e[t].apply(e,this.arguments):t(e,this.arguments)},_mappedItems:function(e){var t=this.source,n=t&&t.collectionOf;return n?e.map(function(e,r){var i=n.from(e);return i.collection=t,i}):e},getCollectionOf:function(){return this.source.getCollectionOf()},_isStrictArray:!0});R("filter",function(){},{updated:function(e,t,n,r){if(!e||e.modifier===this||e.modifier&&e.modifier.constructor===this)return Q.prototype.updated.call(this,e,t,n);var i=n&&n.getContextualized(this)||this;
if("delete"===e.type){var o=i.cachedValue.indexOf(e.oldValue);o>-1&&i.splice(o,1)}else{if("add"!==e.type){if("update"===e.type){var a=e.parent.valueOf(n),o=i.cachedValue.indexOf(a),s=[a].filter(this.arguments[0]).length>0;if(o>-1){if(s)return new c(o,e,i.cachedValue,a);i.splice(o,1)}else s&&i.push(a);return}return Q.prototype.updated.call(this,e,t,n,r)}[e.value].filter(this.arguments[0]).length>0&&i.push(e.value)}}},te),R("map",function(e){this._isStrictArray=e._isStrictArray},{transform:function(e){var t=this.source&&this.source._isStrictArray,n=this.arguments[0];if(e&&e.map){var r=this.source,i=r&&r.collectionOf;return e.map(i?function(e,t){return n(r.property(t),t)}:n)}return t||"map"!==method?fe.prototype.transform.call(this,e):n(e)},updated:function(e,t,n,r){if(!e||e.modifier===this||e.modifier&&e.modifier.constructor===this)return h.prototype.updated.call(this,e,t,n);var i=n&&n.getContextualized(this)||this;if("delete"===e.type)i.splice(e.previousIndex,1);else if("add"===e.type){var o=i.cachedValue;i.push(this.arguments[0].call(this.arguments[1],this.source.property(o&&o.length)))}else{if("update"!==e.type)return Q.prototype.updated.call(this,e,t,n,r);if(this.getCollectionOf())return;var a=e.parent.valueOf(n),o=i.cachedValue,s=e.key,u=e.value;if(s>-1?u=a[s]:s=o&&o.map&&o.indexOf(a),!(s>-1))return Q.prototype.updated.call(this,e,t,n,r);i.splice(s,1,this.arguments[0].call(this.arguments[1],this.source.property(s)))}}},te),R("reduce",function(){}),R("reduceRight",function(){}),R("some",function(){},{},T),R("every",function(){},{},T),R("slice",function(){},{},te),R("keyBy",function(e,t){},{property:X.prototype.property,method:function(e,t){function n(e,t){r.set(e,t)}for(var r=new Map,i=t[0],o=t[1],a="function"==typeof i,s="function"==typeof o,u=!!i,c=0,l=e.length;c<l;c++){var f=e[c];r.set(a?i(f,n):u?f[i]:f,s?o(f):f)}return r}}),R("groupBy",function(e,t){},{property:X.prototype.property,method:function(e,t){for(var n=new Map,r=t[0],i=t[1],o="function"==typeof r,a="function"==typeof i,s=!!r,u=0,c=e.length;u<c;u++){var l=e[u],f=o?r(l):s?l[r]:l,p=n.get(f);p||n.set(f,p=[]),p.push(a?i(l):l)}return n}});var pe=h.getGeneratorDescriptor=function(e){var t;return{get:function(){t||(t=new F);var n=t.get(this);return n||t.set(this,n=new ne(e.bind(this))),n},enumerable:!0}};return h.all=w,h.Context=r,ce})},function(e,t,n){var r,i,o;!function(a,s){i=[n(2),n(6),n(4)],r=s,o="function"==typeof r?r.apply(t,i):r,!(void 0!==o&&(e.exports=o))}(this,function(e,t,n){function r(e){for(var t=0,n=e.length;t<n;t++){var r=e[t];r&&r._getAsObject&&(e[t]=r._getAsObject())}return e}function i(e,t){if("function"!=typeof e)throw new Error("react() must be called with a generator. You need to use the babel-plugin-transform-alkali plugin if you want to use reactive expressions");return t&&t.reverse&&(e.reverse=t.reverse),new n.GeneratorVariable(e)}var o=n.Transform,a=n.Variable,s=e.isGenerator,u=e.compose(o,function(e,t,n){this.sources=n,o.apply(this,arguments)},{_getAsObject:function(){return this.transform.apply(this,r(this.sources))}});return e.copy(i,t),i.from=function(e,t){return e&&e.property?e:"function"==typeof e&&s(e)?i(e,t):a.from(e)},i.prop=function(e,t){if(e){if(e.property){var n=e[t];return void 0!==n?n:e.property(t)}return e[t]}},i.cond=function(e,n,r){return t["if"](e,t.choose(n,r))},i.fcall=function(e,t){return e.property&&"function"==typeof e?e.apply(null,r(t)):new o(t[0],e,t)},i.mcall=function(e,t,n){var i=e[t];return"function"==typeof i&&i.property||"bind"===t?i.apply(e,r(n)):new o(n[0],e[t].bind(e),n)},i.ncall=function(e,t){return e.property&&"function"==typeof e?new(e.bind.apply(e,[null].concat(r(t)))):new o(t[0],function(){return new(e.bind.apply(e,[null].concat(arguments)))},t)},i.obj=function(e,t){return new u(t[0],e,t)},i})},function(e,t,n){var r,i,o;!function(a,s){i=[n(4)],r=s,o="function"==typeof r?r.apply(t,i):r,!(void 0!==o&&(e.exports=o))}(this,function(e){function t(e){return o[e]||(o[e]=new Function("a","b","return "+e))}function n(n,r,i,o,s,u,c){function l(e){e.precedence=o,e.infix=c!==!1}var f=function(e,t){var n,r=t[0],i=t[1];if(r&&r.put)try{return r.put(u(e,i&&i.valueOf()))}catch(o){if(!o.deniedPut)throw o;n=o}if(!i||!i.put)throw n&&n.message?n:new Error("Can not assign change value to constant operators");i.put(c(e,r&&r.valueOf()))},p={apply:function(r,i){return s=t(s),u=u&&t(u),c=c&&t(c),s.reverse=f,a[n]=p=new e.Variable(s),l(p),i=Array.prototype.slice.call(i),p.apply(r,i)}};l(p),a[n]=p,a[i]=function(){var e=p.apply(null,arguments);return r?e.as(r):e}}var r=e.VBoolean,i=e.VNumber,o={},a={};return n("+",i,"add",6,"a+b","a-b","a-b"),n("-",i,"subtract",6,"a-b","a+b","b-a"),n("*",i,"multiply",5,"a*b","a/b","a/b"),n("/",i,"divide",5,"a/b","a*b","b/a"),n("?",null,"if",16,"b[a?0:1]","a===b[0]||(a===b[1]?false:(function(){throw new Error()})())","[a,b]"),n(":",null,"choose",15,"[a,b]","a[0]?a[1]:(function(){throw new Error()})()","a[1]"),n("!",r,"not",4,"!a","!a",!1),n("%",i,"remainder",5,"a%b"),n(">",r,"greater",8,"a>b"),n(">=",r,"greaterOrEqual",8,"a>=b"),n("<",r,"less",8,"a<b"),n("<=",r,"lessOrEqual",8,"a<=b"),n("===",r,"strictEqual",9,"a===b"),n("==",r,"equal",9,"a==b"),n("&",r,"and",8,"a&&b"),n("|",r,"or",8,"a||b"),n("round","round",8,"Math.round(a*Math.pow(10,b||1))/Math.pow(10,b||1)","a","a"),a})},function(e,t,n){var r,i,o;!function(a,s){i=[n(2),n(4)],r=s,o="function"==typeof r?r.apply(t,i):r,!(void 0!==o&&(e.exports=o))}(this,function(e,t){function n(e,t,r){if(e&&"object"==typeof e){if(e instanceof Array){t=[];for(var i=0,o=e.length;i<o;i++)t[i]=n(e[i],null,r)}else{t&&"object"==typeof t||(t=r&&r.get(e),t||(t={},r&&r.set(e,t)));for(var i in e)t[i]=n(e[i],t[i],r)}return t}return e}var r=t.Variable,i=e.compose(r,function(t){this.copiedFrom=t,this.derivativeMap=new e.WeakMap(null,"derivative"),this.isDirty=new r((!1))},{getValue:function(e){this.state&&(this.state=null);var t=this.copiedFrom.valueOf(e);if(t&&"object"==typeof t){var r=this.derivativeMap.get(t);return null==r&&(this.derivativeMap.set(t,r=n(t,void 0,this.derivativeMap)),this.setValue(r,e)),r}return void 0===this.value?t:this.value},getCopyOf:function(e){var t=this.derivativeMap.get(e);return null==t&&this.derivativeMap.set(e,t=n(e,void 0,this.derivativeMap)),t},save:function(){var e=this.copiedFrom.valueOf(),t=n(this.valueOf(),e);this.copiedFrom.put&&this.copiedFrom.put(t),this.isDirty.put(!1),this.onSave&&this.onSave()},revert:function(){var t=this.copiedFrom.valueOf();this.derivativeMap=new e.WeakMap(null,"derivative"),this.put(n(t,void 0,this.derivativeMap)),this.isDirty.put(!1)},updated:function(){return this.isDirty.put(!0),r.prototype.updated.apply(this,arguments)}});return i})}])});
//# sourceMappingURL=index.js.map